import { Component, forwardRef, Input } from '@angular/core';
import { FormGroup, NG_VALUE_ACCESSOR } from '@angular/forms';
import { ERROR_TEXT_STUB } from '../../shared/label/label.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../shared/functions/stand-alone.functions";
import * as i2 from "@ngx-translate/core";
import * as i3 from "@angular/common";
import * as i4 from "../../shared/label/label.component";
import * as i5 from "@angular/forms";
import * as i6 from "../error/error.component";
export class RadioInputComponent {
    constructor(standAloneFunctions, translate) {
        this.standAloneFunctions = standAloneFunctions;
        this.translate = translate;
        this.formGroupEmpty = new FormGroup({});
        this.touched = false;
        this.errorIds = [];
        this.currentStatus = 'VALID';
        this.config = {
            id: '',
            formGroup: this.formGroupEmpty
        };
        this.id = '';
        this.formGroup = this.formGroupEmpty;
        this.labelConfig = {
            formGroup: this.config.formGroup,
            parentID: ''
        };
        this.errorStubText = '';
        this.errorAria = '';
        this.onTouch = () => {
            if (this.formGroup?.get(this.config.id)?.touched === false) {
                this.formGroup?.get(this.config.id)?.markAsTouched();
            }
        };
        this.onChange = (value) => {
            this.config.formGroup.get(this.config.id)?.setValue(value);
        };
    }
    changeValue(event) {
        this.writeValue(event.srcElement.value);
        this.onTouch();
    }
    writeValue(value) {
        this.onChange(value);
    }
    registerOnChange(onChange) {
        this.onChange = onChange;
    }
    registerOnTouched(onTouched) {
        this.onTouch = onTouched;
    }
    markAsTouched() {
        if (!this.touched) {
            this.onTouch();
            this.touched = true;
        }
    }
    ngOnInit() {
        const retControl = this.config.formGroup.get(this.config.id);
        if (retControl) {
            this.formControl = retControl;
        }
        this.setLang(this.translate.currentLang);
        this.translate.onLangChange.subscribe((change) => {
            this.setLang(change.lang);
        });
        this.labelConfig = this.standAloneFunctions.makeLabelConfig(this.config.formGroup, this.config.id, this.config.errorMessages, this.config.label, this.config.desc, this.config.hint, this.config.required, this.config.labelIconConfig);
        //set config from individual options, if present
        if (this.id !== '')
            this.config.id = this.id;
        if (this.formGroup !== this.formGroupEmpty)
            this.config.formGroup = this.formGroup;
        if (this.size)
            this.config.size = this.size;
        if (this.label)
            this.config.label = this.label;
        if (this.desc)
            this.config.desc = this.desc;
        if (this.hint)
            this.config.hint = this.hint;
        if (this.required)
            this.config.required = this.required;
        if (this.options)
            this.config.options = this.options;
        if (this.disabled)
            this.config.disabled = this.disabled;
        if (this.error)
            this.config.error = this.error;
        if (this.validators)
            this.config.validators = this.validators;
        if (this.helpText)
            this.config.helpText = this.helpText;
        if (this.errorMessages)
            this.config.errorMessages = this.errorMessages;
        if (this.config.errorMessages) {
            this.errorIds = this.standAloneFunctions.getErrorIds(this.config.formGroup, this.config.id, this.config.errorMessages);
        }
        this.currentStatus = this.config.formGroup.get(this.config.id)?.status || 'DISABLED';
        this.toggleDisabledState();
        this.config.formGroup
            .get(this.config.id)
            ?.statusChanges.subscribe((change) => {
            this.getAriaErrorText();
            if (change !== this.currentStatus) {
                this.currentStatus = change;
                this.toggleDisabledState();
            }
        });
    }
    toggleDisabledState() {
        switch (this.currentStatus) {
            case 'DISABLED':
                this.setDisabledState(true);
                break;
            default:
                this.setDisabledState(false);
                break;
        }
    }
    ngOnChanges() {
        this.labelConfig = this.standAloneFunctions.makeLabelConfig(this.config.formGroup, this.config.id, this.config.errorMessages, this.config.label, this.config.desc, this.config.hint, this.config.required, this.config.labelIconConfig);
    }
    /**
     * Get the aria error text for the label
     */
    getAriaErrorText() {
        if (this.config.errorMessages) {
            this.formControl?.markAsDirty();
            this.errorAria = this.standAloneFunctions.getErrorAria(this.config.formGroup, this.config.id, this.config.errorMessages);
        }
    }
    /**
     * Set a boolean representing the touched state to true and trigger getAriaErrorText()
     */
    onTouchedLabel() {
        this.touched = true;
        this.getAriaErrorText();
    }
    setLang(lang) {
        this.getAriaErrorText();
        if (lang === 'en' || lang === 'en-US') {
            this.errorStubText = ERROR_TEXT_STUB.en;
        }
        else {
            this.errorStubText = ERROR_TEXT_STUB.fr;
        }
    }
    setDisabledState(isDisabled) {
        if (isDisabled) {
            this.formGroup.get(this.config.id)?.disable();
        }
        else {
            this.formGroup.get(this.config.id)?.enable();
        }
    }
}
RadioInputComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: RadioInputComponent, deps: [{ token: i1.StandAloneFunctions }, { token: i2.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
RadioInputComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.12", type: RadioInputComponent, selector: "ircc-cl-lib-radio-input", inputs: { config: "config", id: "id", formGroup: "formGroup", size: "size", label: "label", desc: "desc", hint: "hint", required: "required", options: "options", disabled: "disabled", error: "error", validators: "validators", helpText: "helpText", errorMessages: "errorMessages" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            multi: true,
            useExisting: forwardRef(() => RadioInputComponent) //This allows the error state to be turned off and on again
        }
    ], usesOnChanges: true, ngImport: i0, template: "<form\n  [formGroup]=\"config.formGroup\"\n  [ngClass]=\"config.size\"\n>\n  <ircc-cl-lib-label\n    [config]=\"labelConfig\"\n    [attr.size]=\"config.size\"\n    [legend]=\"true\"\n  ></ircc-cl-lib-label>\n  <div class=\"radio-buttons\">\n    <div\n      *ngFor=\"let option of config.options; let index = index\"\n      class=\"radio\"\n    >\n      <!-- TODO: See if we can remove the error state from here, since it is controlled by the formControl -->\n      <input\n        (blur)=\"touched = true\"\n        type=\"radio\"\n        value=\"{{ option.value || option.text }}\"\n        id=\"{{ config.id + index }}\"\n        (click)=\"standAloneFunctions.wasTouched(config.formGroup, config.id)\"\n        [formControlName]=\"config.id ? config.id : 'formControl'\"\n        [ngClass]=\"option?.sizeOverride ? option?.sizeOverride : config.size\"\n        [attr.aria-invalid]=\"formControl?.invalid\"\n        [attr.aria-live]=\"'off'\"\n        [attr.aria-label]=\"\n          formControl?.invalid && touched\n            ? (config.label || '' | translate) +\n              ' ' +\n              (config.desc || '' | translate) +\n              ' ' +\n              (config.hint || '' | translate) +\n              ' ' +\n              (config.helpText || '' | translate) +\n              ' ' +\n              (option.text || '' | translate) +\n              ' ' +\n              (errorStubText + ': ' + errorAria)\n            : (config.label || '' | translate) +\n              ' ' +\n              (config.desc || '' | translate) +\n              ' ' +\n              (config.hint || '' | translate) +\n              ' ' +\n              (config.helpText || '' | translate) +\n              ' ' +\n              (option.text || '' | translate)\n        \"\n      />\n      <label\n        for=\"{{ config.id + index }}\"\n        [ngClass]=\"\n          option?.sizeOverride\n            ? option?.sizeOverride + '_label'\n            : config.size + '_label'\n        \"\n        >{{ option.text || '' | translate }}</label\n      >\n    </div>\n  </div>\n  <div aria-live=\"polite\">\n    <ng-container *ngIf=\"config.formGroup.get(config.id)?.touched && currentStatus === 'INVALID'\">\n      <span class=\"sr-only\">{{\n        errorStubText + ': ' + (config.label || '' | translate) + ': '\n      }}</span>\n      <ng-container *ngFor=\"let errors of errorIds; let i = index\">\n        <div\n          *ngIf=\"formControl?.errors?.[errors.key]\"\n          class=\"radio-errors\"\n        >\n          <ircc-cl-lib-error\n            [id]=\"errors.id\"\n            [errorLOV]=\"errors.errorLOV\"\n            [size]=\"config.size\"\n          ></ircc-cl-lib-error>\n        </div>\n      </ng-container>\n    </ng-container>\n  </div>\n</form>\n", dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.LabelComponent, selector: "ircc-cl-lib-label", inputs: ["config", "formGroup", "errorMessages", "parentID", "label", "desc", "hint", "required", "iconButton", "topLabel", "touched", "legend"] }, { kind: "directive", type: i5.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i5.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i5.RadioControlValueAccessor, selector: "input[type=radio][formControlName],input[type=radio][formControl],input[type=radio][ngModel]", inputs: ["name", "formControlName", "value"] }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i5.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i5.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i6.ErrorComponent, selector: "ircc-cl-lib-error", inputs: ["config", "id", "errorLOV", "icon", "size"] }, { kind: "pipe", type: i2.TranslatePipe, name: "translate" }], preserveWhitespaces: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: RadioInputComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ircc-cl-lib-radio-input', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            multi: true,
                            useExisting: forwardRef(() => RadioInputComponent) //This allows the error state to be turned off and on again
                        }
                    ], template: "<form\n  [formGroup]=\"config.formGroup\"\n  [ngClass]=\"config.size\"\n>\n  <ircc-cl-lib-label\n    [config]=\"labelConfig\"\n    [attr.size]=\"config.size\"\n    [legend]=\"true\"\n  ></ircc-cl-lib-label>\n  <div class=\"radio-buttons\">\n    <div\n      *ngFor=\"let option of config.options; let index = index\"\n      class=\"radio\"\n    >\n      <!-- TODO: See if we can remove the error state from here, since it is controlled by the formControl -->\n      <input\n        (blur)=\"touched = true\"\n        type=\"radio\"\n        value=\"{{ option.value || option.text }}\"\n        id=\"{{ config.id + index }}\"\n        (click)=\"standAloneFunctions.wasTouched(config.formGroup, config.id)\"\n        [formControlName]=\"config.id ? config.id : 'formControl'\"\n        [ngClass]=\"option?.sizeOverride ? option?.sizeOverride : config.size\"\n        [attr.aria-invalid]=\"formControl?.invalid\"\n        [attr.aria-live]=\"'off'\"\n        [attr.aria-label]=\"\n          formControl?.invalid && touched\n            ? (config.label || '' | translate) +\n              ' ' +\n              (config.desc || '' | translate) +\n              ' ' +\n              (config.hint || '' | translate) +\n              ' ' +\n              (config.helpText || '' | translate) +\n              ' ' +\n              (option.text || '' | translate) +\n              ' ' +\n              (errorStubText + ': ' + errorAria)\n            : (config.label || '' | translate) +\n              ' ' +\n              (config.desc || '' | translate) +\n              ' ' +\n              (config.hint || '' | translate) +\n              ' ' +\n              (config.helpText || '' | translate) +\n              ' ' +\n              (option.text || '' | translate)\n        \"\n      />\n      <label\n        for=\"{{ config.id + index }}\"\n        [ngClass]=\"\n          option?.sizeOverride\n            ? option?.sizeOverride + '_label'\n            : config.size + '_label'\n        \"\n        >{{ option.text || '' | translate }}</label\n      >\n    </div>\n  </div>\n  <div aria-live=\"polite\">\n    <ng-container *ngIf=\"config.formGroup.get(config.id)?.touched && currentStatus === 'INVALID'\">\n      <span class=\"sr-only\">{{\n        errorStubText + ': ' + (config.label || '' | translate) + ': '\n      }}</span>\n      <ng-container *ngFor=\"let errors of errorIds; let i = index\">\n        <div\n          *ngIf=\"formControl?.errors?.[errors.key]\"\n          class=\"radio-errors\"\n        >\n          <ircc-cl-lib-error\n            [id]=\"errors.id\"\n            [errorLOV]=\"errors.errorLOV\"\n            [size]=\"config.size\"\n          ></ircc-cl-lib-error>\n        </div>\n      </ng-container>\n    </ng-container>\n  </div>\n</form>\n" }]
        }], ctorParameters: function () { return [{ type: i1.StandAloneFunctions }, { type: i2.TranslateService }]; }, propDecorators: { config: [{
                type: Input
            }], id: [{
                type: Input
            }], formGroup: [{
                type: Input
            }], size: [{
                type: Input
            }], label: [{
                type: Input
            }], desc: [{
                type: Input
            }], hint: [{
                type: Input
            }], required: [{
                type: Input
            }], options: [{
                type: Input
            }], disabled: [{
                type: Input
            }], error: [{
                type: Input
            }], validators: [{
                type: Input
            }], helpText: [{
                type: Input
            }], errorMessages: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFkaW8taW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vY29tcG9uZW50LWxpYi9zcmMvbGliL2Zvcm0tY29tcG9uZW50cy9yYWRpby1pbnB1dC9yYWRpby1pbnB1dC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9jb21wb25lbnQtbGliL3NyYy9saWIvZm9ybS1jb21wb25lbnRzL3JhZGlvLWlucHV0L3JhZGlvLWlucHV0LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUlMLFNBQVMsRUFDVCxpQkFBaUIsRUFFbEIsTUFBTSxnQkFBZ0IsQ0FBQztBQU94QixPQUFPLEVBQ0wsZUFBZSxFQUdoQixNQUFNLG9DQUFvQyxDQUFDOzs7Ozs7OztBQXVDNUMsTUFBTSxPQUFPLG1CQUFtQjtJQWtDOUIsWUFDUyxtQkFBd0MsRUFDdkMsU0FBMkI7UUFENUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN2QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQWpDckMsbUJBQWMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuQyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLGFBQVEsR0FBZ0IsRUFBRSxDQUFDO1FBRTNCLGtCQUFhLEdBQXNCLE9BQU8sQ0FBQztRQUVsQyxXQUFNLEdBQStCO1lBQzVDLEVBQUUsRUFBRSxFQUFFO1lBQ04sU0FBUyxFQUFFLElBQUksQ0FBQyxjQUFjO1NBQy9CLENBQUM7UUFDTyxPQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ1IsY0FBUyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFhekMsZ0JBQVcsR0FBaUI7WUFDMUIsU0FBUyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUztZ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SSxDQUFDLFNBQVMsQ0FBQztRQUN6QyxJQUFJLElBQUksQ0FBQyxJQUFJO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QyxJQUFJLElBQUksQ0FBQyxLQUFLO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUMvQyxJQUFJLElBQUksQ0FBQyxJQUFJO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QyxJQUFJLElBQUksQ0FBQyxJQUFJO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QyxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN4RCxJQUFJLElBQUksQ0FBQyxPQUFPO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUNyRCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN4RCxJQUFJLElBQUksQ0FBQyxLQUFLO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUMvQyxJQUFJLElBQUksQ0FBQyxVQUFVO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUM5RCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN4RCxJQUFJLElBQUksQ0FBQyxhQUFhO1lBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFB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bnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBmb3J3YXJkUmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFic3RyYWN0Q29udHJvbCxcbiAgQ29udHJvbFZhbHVlQWNjZXNzb3IsXG4gIEZvcm1Db250cm9sU3RhdHVzLFxuICBGb3JtR3JvdXAsXG4gIE5HX1ZBTFVFX0FDQ0VTU09SLFxuICBWYWxpZGF0b3JGblxufSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBJRXJyb3JQYWlycyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9pbnRlcmZhY2VzL2NvbXBvbmVudC1jb25maWdzJztcbmltcG9ydCB7IERTU2l6ZXMgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvY29uc3RhbnRzL2psLWNvbXBvbmVudHMuY29uc3RhbnRzJztcbmltcG9ydCB7XG4gIElFcnJvcklEcyxcbiAgU3RhbmRBbG9uZUZ1bmN0aW9uc1xufSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvZnVuY3Rpb25zL3N0YW5kLWFsb25lLmZ1bmN0aW9ucyc7XG5pbXBvcnQge1xuICBFUlJPUl9URVhUX1NUVUIsXG4gIElMYWJlbENvbmZpZyxcbiAgSUxhYmVsSWNvbkNvbmZpZ1xufSBmcm9tICcuLi8uLi9zaGFyZWQvbGFiZWwvbGFiZWwuY29tcG9uZW50JztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcblxuZXhwb3J0IGludGVyZmFjZSBJUmFkaW9JbnB1dENvbXBvbmVudENvbmZpZyB7XG4gIGlkOiBzdHJpbmc7XG4gIGZvcm1Hcm91cDogRm9ybUdyb3VwO1xuICBsYWJlbD86IHN0cmluZztcbiAgZGVzYz86IHN0cmluZztcbiAgaGludD86IHN0cmluZztcbiAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICBvcHRpb25zPzogSVJhZGlvSW5wdXRPcHRpb25bXTtcbiAgc2l6ZT86IGtleW9mIHR5cGVvZiBEU1NpemVzO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIGVycm9yPzogdHJ1ZTtcbiAgdmFsaWRhdG9ycz86IFZhbGlkYXRvckZuW107XG4gIGhlbHBUZXh0Pzogc3RyaW5nO1xuICBlcnJvck1lc3NhZ2VzPzogSUVycm9yUGFpcnNbXTtcbiAgbGFiZWxJY29uQ29uZmlnPzogSUxhYmVsSWNvbkNvbmZpZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUmFkaW9JbnB1dE9wdGlvbiB7XG4gIHRleHQ6IHN0cmluZztcbiAgdmFsdWU/OiBzdHJpbmc7XG4gIHNpemVPdmVycmlkZT86IGtleW9mIHR5cGVvZiBEU1NpemVzO1xuICBkaXNhYmxlZD86IHRydWU7XG4gIGVycm9yPzogdHJ1ZTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXJjYy1jbC1saWItcmFkaW8taW5wdXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcmFkaW8taW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUmFkaW9JbnB1dENvbXBvbmVudCkgLy9UaGlzIGFsbG93cyB0aGUgZXJyb3Igc3RhdGUgdG8gYmUgdHVybmVkIG9mZiBhbmQgb24gYWdhaW5cbiAgICB9XG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgUmFkaW9JbnB1dENvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBDb250cm9sVmFsdWVBY2Nlc3Nvclxue1xuICBmb3JtR3JvdXBFbXB0eSA9IG5ldyBGb3JtR3JvdXAoe30pO1xuICB0b3VjaGVkID0gZmFsc2U7XG4gIGVycm9ySWRzOiBJRXJyb3JJRHNbXSA9IFtdO1xuICBmb3JtQ29udHJvbD86IEFic3RyYWN0Q29udHJvbDtcbiAgY3VycmVudFN0YXR1czogRm9ybUNvbnRyb2xTdGF0dXMgPSAnVkFMSUQnO1xuXG4gIEBJbnB1dCgpIGNvbmZpZzogSVJhZGlvSW5wdXRDb21wb25lbnRDb25maWcgPSB7XG4gICAgaWQ6ICcnLFxuICAgIGZvcm1Hcm91cDogdGhpcy5mb3JtR3JvdXBFbXB0eVxuICB9O1xuICBASW5wdXQoKSBpZCA9ICcnO1xuICBASW5wdXQoKSBmb3JtR3JvdXAgPSB0aGlzLmZvcm1Hcm91cEVtcHR5O1xuICBASW5wdXQoKSBzaXplPzoga2V5b2YgdHlwZW9mIERTU2l6ZXM7XG4gIEBJbnB1dCgpIGxhYmVsPzogc3RyaW5nO1xuICBASW5wdXQoKSBkZXNjPzogc3RyaW5nO1xuICBASW5wdXQoKSBoaW50Pzogc3RyaW5nO1xuICBASW5wdXQoKSByZXF1aXJlZD86IGJvb2xlYW47XG4gIEBJbnB1dCgpIG9wdGlvbnM/OiBJUmFkaW9JbnB1dE9wdGlvbltdO1xuICBASW5wdXQoKSBkaXNhYmxlZD86IGJvb2xlYW47XG4gIEBJbnB1dCgpIGVycm9yPzogdHJ1ZTtcbiAgQElucHV0KCkgdmFsaWRhdG9ycz86IFZhbGlkYXRvckZuW107XG4gIEBJbnB1dCgpIGhlbHBUZXh0Pzogc3RyaW5nO1xuICBASW5wdXQoKSBlcnJvck1lc3NhZ2VzPzogSUVycm9yUGFpcnNbXTtcblxuICBsYWJlbENvbmZpZzogSUxhYmVsQ29uZmlnID0ge1xuICAgIGZvcm1Hcm91cDogdGhpcy5jb25maWcuZm9ybUdyb3VwLFxuICAgIHBhcmVudElEOiAnJ1xuICB9O1xuICBlcnJvclN0dWJUZXh0ID0gJyc7XG4gIGVycm9yQXJpYSA9ICcnO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBzdGFuZEFsb25lRnVuY3Rpb25zOiBTdGFuZEFsb25lRnVuY3Rpb25zLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlXG4gICkge31cblxuICBvblRvdWNoID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmZvcm1Hcm91cD8uZ2V0KHRoaXMuY29uZmlnLmlkKT8udG91Y2hlZCA9PT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuZm9ybUdyb3VwPy5nZXQodGhpcy5jb25maWcuaWQpPy5tYXJrQXNUb3VjaGVkKCk7XG4gICAgfVxuICB9O1xuXG4gIG9uQ2hhbmdlID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICB0aGlzLmNvbmZpZy5mb3JtR3JvdXAuZ2V0KHRoaXMuY29uZmlnLmlkKT8uc2V0VmFsdWUodmFsdWUpO1xuICB9O1xuICBcbiAgY2hhbmdlVmFsdWUoZXZlbnQ6IGFueSl7XG4gICAgdGhpcy53cml0ZVZhbHVlKGV2ZW50LnNyY0VsZW1lbnQudmFsdWUpO1xuICAgIHRoaXMub25Ub3VjaCgpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLm9uQ2hhbmdlKHZhbHVlKTtcbiAgfVxuICBcbiAgcmVnaXN0ZXJPbkNoYW5nZShvbkNoYW5nZTogYW55KSB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuICB9XG4gIFxuICByZWdpc3Rlck9uVG91Y2hlZChvblRvdWNoZWQ6IGFueSkge1xuICAgIHRoaXMub25Ub3VjaCA9IG9uVG91Y2hlZDtcbiAgfVxuXG4gIG1hcmtBc1RvdWNoZWQoKSB7XG4gICAgaWYgKCF0aGlzLnRvdWNoZWQpIHtcbiAgICAgIHRoaXMub25Ub3VjaCgpO1xuICAgICAgdGhpcy50b3VjaGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCByZXRDb250cm9sID0gdGhpcy5jb25maWcuZm9ybUdyb3VwLmdldCh0aGlzLmNvbmZpZy5pZCk7XG4gICAgaWYgKHJldENvbnRyb2wpIHtcbiAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSByZXRDb250cm9sO1xuICAgIH1cblxuICAgIHRoaXMuc2V0TGFuZyh0aGlzLnRyYW5zbGF0ZS5jdXJyZW50TGFuZyk7XG4gICAgdGhpcy50cmFuc2xhdGUub25MYW5nQ2hhbmdlLnN1YnNjcmliZSgoY2hhbmdlKSA9PiB7XG4gICAgICB0aGlzLnNldExhbmcoY2hhbmdlLmxhbmcpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5sYWJlbENvbmZpZyA9IHRoaXMuc3RhbmRBbG9uZUZ1bmN0aW9ucy5tYWtlTGFiZWxDb25maWcoXG4gICAgICB0aGlzLmNvbmZpZy5mb3JtR3JvdXAsXG4gICAgICB0aGlzLmNvbmZpZy5pZCxcbiAgICAgIHRoaXMuY29uZmlnLmVycm9yTWVzc2FnZXMsXG4gICAgICB0aGlzLmNvbmZpZy5sYWJlbCxcbiAgICAgIHRoaXMuY29uZmlnLmRlc2MsXG4gICAgICB0aGlzLmNvbmZpZy5oaW50LFxuICAgICAgdGhpcy5jb25maWcucmVxdWlyZWQsXG4gICAgICB0aGlzLmNvbmZpZy5sYWJlbEljb25Db25maWdcbiAgICApO1xuXG4gICAgLy9zZXQgY29uZmlnIGZyb20gaW5kaXZpZHVhbCBvcHRpb25zLCBpZiBwcmVzZW50XG4gICAgaWYgKHRoaXMuaWQgIT09ICcnKSB0aGlzLmNvbmZpZy5pZCA9IHRoaXMuaWQ7XG4gICAgaWYgKHRoaXMuZm9ybUdyb3VwICE9PSB0aGlzLmZvcm1Hcm91cEVtcHR5KVxuICAgICAgdGhpcy5jb25maWcuZm9ybUdyb3VwID0gdGhpcy5mb3JtR3JvdXA7XG4gICAgaWYgKHRoaXMuc2l6ZSkgdGhpcy5jb25maWcuc2l6ZSA9IHRoaXMuc2l6ZTtcbiAgICBpZiAodGhpcy5sYWJlbCkgdGhpcy5jb25maWcubGFiZWwgPSB0aGlzLmxhYmVsO1xuICAgIGlmICh0aGlzLmRlc2MpIHRoaXMuY29uZmlnLmRlc2MgPSB0aGlzLmRlc2M7XG4gICAgaWYgKHRoaXMuaGludCkgdGhpcy5jb25maWcuaGludCA9IHRoaXMuaGludDtcbiAgICBpZiAodGhpcy5yZXF1aXJlZCkgdGhpcy5jb25maWcucmVxdWlyZWQgPSB0aGlzLnJlcXVpcmVkO1xuICAgIGlmICh0aGlzLm9wdGlvbnMpIHRoaXMuY29uZmlnLm9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHRoaXMuY29uZmlnLmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZDtcbiAgICBpZiAodGhpcy5lcnJvcikgdGhpcy5jb25maWcuZXJyb3IgPSB0aGlzLmVycm9yO1xuICAgIGlmICh0aGlzLnZhbGlkYXRvcnMpIHRoaXMuY29uZmlnLnZhbGlkYXRvcnMgPSB0aGlzLnZhbGlkYXRvcnM7XG4gICAgaWYgKHRoaXMuaGVscFRleHQpIHRoaXMuY29uZmlnLmhlbHBUZXh0ID0gdGhpcy5oZWxwVGV4dDtcbiAgICBpZiAodGhpcy5lcnJvck1lc3NhZ2VzKSB0aGlzLmNvbmZpZy5lcnJvck1lc3NhZ2VzID0gdGhpcy5lcnJvck1lc3NhZ2VzO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLmVycm9yTWVzc2FnZXMpIHtcbiAgICAgIHRoaXMuZXJyb3JJZHMgPSB0aGlzLnN0YW5kQWxvbmVGdW5jdGlvbnMuZ2V0RXJyb3JJZHMoXG4gICAgICAgIHRoaXMuY29uZmlnLmZvcm1Hcm91cCxcbiAgICAgICAgdGhpcy5jb25maWcuaWQsXG4gICAgICAgIHRoaXMuY29uZmlnLmVycm9yTWVzc2FnZXNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50U3RhdHVzID0gdGhpcy5jb25maWcuZm9ybUdyb3VwLmdldCh0aGlzLmNvbmZpZy5pZCk/LnN0YXR1cyB8fCAnRElTQUJMRUQnO1xuICAgIHRoaXMudG9nZ2xlRGlzYWJsZWRTdGF0ZSgpO1xuICAgIHRoaXMuY29uZmlnLmZvcm1Hcm91cFxuICAgIC5nZXQodGhpcy5jb25maWcuaWQpXG4gICAgPy5zdGF0dXNDaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlKSA9PiB7XG4gICAgICB0aGlzLmdldEFyaWFFcnJvclRleHQoKTtcbiAgICAgIGlmIChjaGFuZ2UgIT09IHRoaXMuY3VycmVudFN0YXR1cykge1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGF0dXMgPSBjaGFuZ2U7XG4gICAgICAgIHRoaXMudG9nZ2xlRGlzYWJsZWRTdGF0ZSgpO1xuICAgICAgfVxuICAgIH0pO1xufVxuXG4gICAgdG9nZ2xlRGlzYWJsZWRTdGF0ZSgpIHtcbiAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFN0YXR1cykge1xuICAgICAgY2FzZSAnRElTQUJMRUQnOlxuICAgICAgdGhpcy5zZXREaXNhYmxlZFN0YXRlKHRydWUpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRoaXMuc2V0RGlzYWJsZWRTdGF0ZShmYWxzZSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICB0aGlzLmxhYmVsQ29uZmlnID0gdGhpcy5zdGFuZEFsb25lRnVuY3Rpb25zLm1ha2VMYWJlbENvbmZpZyhcbiAgICAgIHRoaXMuY29uZmlnLmZvcm1Hcm91cCxcbiAgICAgIHRoaXMuY29uZmlnLmlkLFxuICAgICAgdGhpcy5jb25maWcuZXJyb3JNZXNzYWdlcyxcbiAgICAgIHRoaXMuY29uZmlnLmxhYmVsLFxuICAgICAgdGhpcy5jb25maWcuZGVzYyxcbiAgICAgIHRoaXMuY29uZmlnLmhpbnQsXG4gICAgICB0aGlzLmNvbmZpZy5yZXF1aXJlZCxcbiAgICAgIHRoaXMuY29uZmlnLmxhYmVsSWNvbkNvbmZpZ1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBhcmlhIGVycm9yIHRleHQgZm9yIHRoZSBsYWJlbFxuICAgKi9cbiAgZ2V0QXJpYUVycm9yVGV4dCgpIHtcbiAgICBpZiAodGhpcy5jb25maWcuZXJyb3JNZXNzYWdlcykge1xuICAgICAgdGhpcy5mb3JtQ29udHJvbD8ubWFya0FzRGlydHkoKTtcbiAgICAgIHRoaXMuZXJyb3JBcmlhID0gdGhpcy5zdGFuZEFsb25lRnVuY3Rpb25zLmdldEVycm9yQXJpYShcbiAgICAgICAgdGhpcy5jb25maWcuZm9ybUdyb3VwLFxuICAgICAgICB0aGlzLmNvbmZpZy5pZCxcbiAgICAgICAgdGhpcy5jb25maWcuZXJyb3JNZXNzYWdlc1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGEgYm9vbGVhbiByZXByZXNlbnRpbmcgdGhlIHRvdWNoZWQgc3RhdGUgdG8gdHJ1ZSBhbmQgdHJpZ2dlciBnZXRBcmlhRXJyb3JUZXh0KClcbiAgICovXG4gIG9uVG91Y2hlZExhYmVsKCkge1xuICAgIHRoaXMudG91Y2hlZCA9IHRydWU7XG4gICAgdGhpcy5nZXRBcmlhRXJyb3JUZXh0KCk7XG4gIH1cblxuICBzZXRMYW5nKGxhbmc6IHN0cmluZykge1xuICAgIHRoaXMuZ2V0QXJpYUVycm9yVGV4dCgpO1xuICAgIGlmIChsYW5nID09PSAnZW4nIHx8IGxhbmcgPT09ICdlbi1VUycpIHtcbiAgICAgIHRoaXMuZXJyb3JTdHViVGV4dCA9IEVSUk9SX1RFWFRfU1RVQi5lbjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnJvclN0dWJUZXh0ID0gRVJST1JfVEVYVF9TVFVCLmZyO1xuICAgIH1cbiAgfVxuICBcbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKSB7XG4gICAgaWYoaXNEaXNhYmxlZCl7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5jb25maWcuaWQpPy5kaXNhYmxlKCk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5jb25maWcuaWQpPy5lbmFibGUoKTtcbiAgICB9XG4gIH1cbn1cbiIsIjxmb3JtXG4gIFtmb3JtR3JvdXBdPVwiY29uZmlnLmZvcm1Hcm91cFwiXG4gIFtuZ0NsYXNzXT1cImNvbmZpZy5zaXplXCJcbj5cbiAgPGlyY2MtY2wtbGliLWxhYmVsXG4gICAgW2NvbmZpZ109XCJsYWJlbENvbmZpZ1wiXG4gICAgW2F0dHIuc2l6ZV09XCJjb25maWcuc2l6ZVwiXG4gICAgW2xlZ2VuZF09XCJ0cnVlXCJcbiAgPjwvaXJjYy1jbC1saWItbGFiZWw+XG4gIDxkaXYgY2xhc3M9XCJyYWRpby1idXR0b25zXCI+XG4gICAgPGRpdlxuICAgICAgKm5nRm9yPVwibGV0IG9wdGlvbiBvZiBjb25maWcub3B0aW9uczsgbGV0IGluZGV4ID0gaW5kZXhcIlxuICAgICAgY2xhc3M9XCJyYWRpb1wiXG4gICAgPlxuICAgICAgPCEtLSBUT0RPOiBTZWUgaWYgd2UgY2FuIHJlbW92ZSB0aGUgZXJyb3Igc3RhdGUgZnJvbSBoZXJlLCBzaW5jZSBpdCBpcyBjb250cm9sbGVkIGJ5IHRoZSBmb3JtQ29udHJvbCAtLT5cbiAgICAgIDxpbnB1dFxuICAgICAgICAoYmx1cik9XCJ0b3VjaGVkID0gdHJ1ZVwiXG4gICAgICAgIHR5cGU9XCJyYWRpb1wiXG4gICAgICAgIHZhbHVlPVwie3sgb3B0aW9uLnZhbHVlIHx8IG9wdGlvbi50ZXh0IH19XCJcbiAgICAgICAgaWQ9XCJ7eyBjb25maWcuaWQgKyBpbmRleCB9fVwiXG4gICAgICAgIChjbGljayk9XCJzdGFuZEFsb25lRnVuY3Rpb25zLndhc1RvdWNoZWQoY29uZmlnLmZvcm1Hcm91cCwgY29uZmlnLmlkKVwiXG4gICAgICAgIFtmb3JtQ29udHJvbE5hbWVdPVwiY29uZmlnLmlkID8gY29uZmlnLmlkIDogJ2Zvcm1Db250cm9sJ1wiXG4gICAgICAgIFtuZ0NsYXNzXT1cIm9wdGlvbj8uc2l6ZU92ZXJyaWRlID8gb3B0aW9uPy5zaXplT3ZlcnJpZGUgOiBjb25maWcuc2l6ZVwiXG4gICAgICAgIFthdHRyLmFyaWEtaW52YWxpZF09XCJmb3JtQ29udHJvbD8uaW52YWxpZFwiXG4gICAgICAgIFthdHRyLmFyaWEtbGl2ZV09XCInb2ZmJ1wiXG4gICAgICAgIFthdHRyLmFyaWEtbGFiZWxdPVwiXG4gICAgICAgICAgZm9ybUNvbnRyb2w/LmludmFsaWQgJiYgdG91Y2hlZFxuICAgICAgICAgICAgPyAoY29uZmlnLmxhYmVsIHx8ICcnIHwgdHJhbnNsYXRlKSArXG4gICAgICAgICAgICAgICcgJyArXG4gICAgICAgICAgICAgIChjb25maWcuZGVzYyB8fCAnJyB8IHRyYW5zbGF0ZSkgK1xuICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICAoY29uZmlnLmhpbnQgfHwgJycgfCB0cmFuc2xhdGUpICtcbiAgICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgICAgKGNvbmZpZy5oZWxwVGV4dCB8fCAnJyB8IHRyYW5zbGF0ZSkgK1xuICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICAob3B0aW9uLnRleHQgfHwgJycgfCB0cmFuc2xhdGUpICtcbiAgICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgICAgKGVycm9yU3R1YlRleHQgKyAnOiAnICsgZXJyb3JBcmlhKVxuICAgICAgICAgICAgOiAoY29uZmlnLmxhYmVsIHx8ICcnIHwgdHJhbnNsYXRlKSArXG4gICAgICAgICAgICAgICcgJyArXG4gICAgICAgICAgICAgIChjb25maWcuZGVzYyB8fCAnJyB8IHRyYW5zbGF0ZSkgK1xuICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICAoY29uZmlnLmhpbnQgfHwgJycgfCB0cmFuc2xhdGUpICtcbiAgICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgICAgKGNvbmZpZy5oZWxwVGV4dCB8fCAnJyB8IHRyYW5zbGF0ZSkgK1xuICAgICAgICAgICAgICAnICcgK1xuICAgICAgICAgICAgICAob3B0aW9uLnRleHQgfHwgJycgfCB0cmFuc2xhdGUpXG4gICAgICAgIFwiXG4gICAgICAvPlxuICAgICAgPGxhYmVsXG4gICAgICAgIGZvcj1cInt7IGNvbmZpZy5pZCArIGluZGV4IH19XCJcbiAgICAgICAgW25nQ2xhc3NdPVwiXG4gICAgICAgICAgb3B0aW9uPy5zaXplT3ZlcnJpZGVcbiAgICAgICAgICAgID8gb3B0aW9uPy5zaXplT3ZlcnJpZGUgKyAnX2xhYmVsJ1xuICAgICAgICAgICAgOiBjb25maWcuc2l6ZSArICdfbGFiZWwnXG4gICAgICAgIFwiXG4gICAgICAgID57eyBvcHRpb24udGV4dCB8fCAnJyB8IHRyYW5zbGF0ZSB9fTwvbGFiZWxcbiAgICAgID5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIDxkaXYgYXJpYS1saXZlPVwicG9saXRlXCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImNvbmZpZy5mb3JtR3JvdXAuZ2V0KGNvbmZpZy5pZCk/LnRvdWNoZWQgJiYgY3VycmVudFN0YXR1cyA9PT0gJ0lOVkFMSUQnXCI+XG4gICAgICA8c3BhbiBjbGFzcz1cInNyLW9ubHlcIj57e1xuICAgICAgICBlcnJvclN0dWJUZXh0ICsgJzogJyArIChjb25maWcubGFiZWwgfHwgJycgfCB0cmFuc2xhdGUpICsgJzogJ1xuICAgICAgfX08L3NwYW4+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBlcnJvcnMgb2YgZXJyb3JJZHM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgICAgPGRpdlxuICAgICAgICAgICpuZ0lmPVwiZm9ybUNvbnRyb2w/LmVycm9ycz8uW2Vycm9ycy5rZXldXCJcbiAgICAgICAgICBjbGFzcz1cInJhZGlvLWVycm9yc1wiXG4gICAgICAgID5cbiAgICAgICAgICA8aXJjYy1jbC1saWItZXJyb3JcbiAgICAgICAgICAgIFtpZF09XCJlcnJvcnMuaWRcIlxuICAgICAgICAgICAgW2Vycm9yTE9WXT1cImVycm9ycy5lcnJvckxPVlwiXG4gICAgICAgICAgICBbc2l6ZV09XCJjb25maWcuc2l6ZVwiXG4gICAgICAgICAgPjwvaXJjYy1jbC1saWItZXJyb3I+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuPC9mb3JtPlxuIl19