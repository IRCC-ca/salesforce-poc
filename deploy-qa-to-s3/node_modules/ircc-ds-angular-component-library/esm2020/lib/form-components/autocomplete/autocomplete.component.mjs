import { Component, Input, SecurityContext, ViewChild } from '@angular/core';
import { FormGroup } from '@angular/forms';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "@angular/common";
import * as i3 from "../../shared/flyout/flyout.component";
import * as i4 from "../input/input.component";
export var matchType;
(function (matchType) {
    matchType["infix"] = "infix";
    matchType["prefix"] = "prefix";
})(matchType || (matchType = {}));
export class AutoCompleteComponent {
    constructor(domSanitizer, changeDetectorRef) {
        this.domSanitizer = domSanitizer;
        this.changeDetectorRef = changeDetectorRef;
        this.formGroupEmpty = new FormGroup({});
        this.config = {
            id: 'auto-complete',
            formGroup: this.formGroupEmpty,
            label: 'label',
            hint: 'hint',
            desc: 'desc',
            size: 'small',
            suggestions: []
        };
        this.matchType = 'infix';
        this.showSuggestions = false;
        this.formGroup = this.formGroupEmpty;
        this.inputComponent = {
            ...this.config,
            type: 'autocomplete'
        };
        this.flyout = {
            id: 'string',
            options: [],
            type: 'autocomplete',
            size: this.config.size
        };
    }
    ngOnChanges(changes) {
        this.inputComponent = {
            ...this.config,
            type: 'autocomplete'
        };
        this.flyout.size = this.config.size;
    }
    ngAfterContentChecked() {
        this.changeDetectorRef.detectChanges();
    }
    ngOnInit() {
        if (this.formGroup !== this.formGroupEmpty) {
            this.config.formGroup = this.formGroup;
        }
        this.inputComponent.id = this.config.id;
        this.inputComponent.formGroup = this.config.formGroup;
        this.inputComponent.label = this.config.label;
        this.inputComponent.hint = this.config.hint;
        this.inputComponent.desc = this.config.desc;
        this.inputComponent.size = this.config.size;
        this.inputComponent.errorMessages = this.config.errorMessages;
        this.inputComponent.placeholder = this.config.placeholder;
        this.flyout.id = `${this.config.id}-flyout`;
        this.flyout.options = this.config.suggestions.map((suggestion) => {
            return {
                value: suggestion,
                clickable: true
            };
        });
        this.config.formGroup
            .get(this.config.id)
            ?.valueChanges.subscribe((data) => {
            if (data === null || data.length === 0) {
                this.flyout.selected = '';
                this.flyout.options = [];
                this.flyout.options = this.config.suggestions.map((suggestion) => {
                    return {
                        value: suggestion,
                        clickable: true
                    };
                });
            }
            else {
                this.validateInternal(data);
            }
        });
        this.inputComponent = {
            ...this.config,
            type: 'autocomplete'
        };
    }
    spreadFlyoutOption(value) {
        return {
            value: value,
            clickable: true
        };
    }
    onFocus(event) {
        let timeoutTime = 0;
        if (event === false) {
            timeoutTime = 500;
        }
        setTimeout(() => {
            this.showSuggestions = event;
        }, timeoutTime);
        // Set 1st option as active when on focus
        if (this.flyout.options.length > 0) {
            this.flyout.options[0].active = true;
        }
    }
    isSelected(event) {
        if (event !== null) {
            const tempDivElement = document.createElement('div');
            tempDivElement.innerHTML = event || '';
            const convertedString = tempDivElement.textContent || tempDivElement.innerText || '';
            this.config.formGroup.get(this.config.id)?.setValue(convertedString);
            this.showSuggestions = false;
        }
    }
    validateInternal(data) {
        this.flyout.options = [];
        let eventString = this.domSanitizer.sanitize(SecurityContext.HTML, data.replace(/<[^>]*>/g, ''));
        let re;
        if (this.matchType === 'infix') {
            const infixMatching = new RegExp(`${data}`);
            re = new RegExp(`${infixMatching.source}`, 'i');
        }
        else {
            const paragraphStart = new RegExp(`^${data}`);
            const whitespaceStart = new RegExp(`\\s+\\b${data}[a-zA-Z]*`);
            re = new RegExp(`${paragraphStart.source}|${whitespaceStart.source}`, 'i');
        }
        this.flyout.selected = data;
        this.flyout.options = this.config.suggestions
            .filter((suggestion) => suggestion.search(re) >= 0)
            .map((suggestion) => {
            return {
                value: suggestion,
                clickable: true
            };
        });
        if (this.flyout.options.length === 0) {
            this.flyout.options = [
                {
                    value: 'No options found',
                    clickable: false
                }
            ];
        }
    }
}
AutoCompleteComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: AutoCompleteComponent, deps: [{ token: i1.DomSanitizer }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
AutoCompleteComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.12", type: AutoCompleteComponent, selector: "ircc-cl-lib-autocomplete", inputs: { config: "config", formGroup: "formGroup" }, viewQueries: [{ propertyName: "inputAutocomplete", first: true, predicate: ["inputAutocomplete"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div\n  #inputAutocomplete\n  [attr.size]=\"config.size\"\n>\n  <ircc-cl-lib-input\n    [attr.size]=\"config.size\"\n    [config]=\"inputComponent\"\n    type=\"autocomplete\"\n    (focusEvent)=\"onFocus($event)\"\n  ></ircc-cl-lib-input>\n\n  <ng-container *ngIf=\"showSuggestions === true\">\n    <ircc-cl-lib-flyout\n      (isSelected)=\"isSelected($event)\"\n      [config]=\"flyout\"\n      [class]=\"config.size\"\n    ></ircc-cl-lib-flyout>\n  </ng-container>\n</div>\n", styles: [""], dependencies: [{ kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.FlyoutComponent, selector: "ircc-cl-lib-flyout", inputs: ["config", "id", "options", "disabled", "selection", "type", "size"], outputs: ["isSelected"] }, { kind: "component", type: i4.InputComponent, selector: "ircc-cl-lib-input", inputs: ["config", "id", "formGroup", "type", "size", "label", "hint", "desc", "required", "placeholder", "errorMessages"], outputs: ["focusEvent"] }], preserveWhitespaces: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: AutoCompleteComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ircc-cl-lib-autocomplete', template: "<div\n  #inputAutocomplete\n  [attr.size]=\"config.size\"\n>\n  <ircc-cl-lib-input\n    [attr.size]=\"config.size\"\n    [config]=\"inputComponent\"\n    type=\"autocomplete\"\n    (focusEvent)=\"onFocus($event)\"\n  ></ircc-cl-lib-input>\n\n  <ng-container *ngIf=\"showSuggestions === true\">\n    <ircc-cl-lib-flyout\n      (isSelected)=\"isSelected($event)\"\n      [config]=\"flyout\"\n      [class]=\"config.size\"\n    ></ircc-cl-lib-flyout>\n  </ng-container>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i1.DomSanitizer }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { inputAutocomplete: [{
                type: ViewChild,
                args: ['inputAutocomplete', { static: false }]
            }], config: [{
                type: Input
            }], formGroup: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2NvbXBvbmVudC1saWIvc3JjL2xpYi9mb3JtLWNvbXBvbmVudHMvYXV0b2NvbXBsZXRlL2F1dG9jb21wbGV0ZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9jb21wb25lbnQtbGliL3NyYy9saWIvZm9ybS1jb21wb25lbnRzL2F1dG9jb21wbGV0ZS9hdXRvY29tcGxldGUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUlMLFNBQVMsRUFHVCxLQUFLLEVBSUwsZUFBZSxFQUVmLFNBQVMsRUFFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWUsU0FBUyxFQUFjLE1BQU0sZ0JBQWdCLENBQUM7Ozs7OztBQXdCcEUsTUFBTSxDQUFOLElBQVksU0FHWDtBQUhELFdBQVksU0FBUztJQUNuQiw0QkFBZSxDQUFBO0lBQ2YsOEJBQWlCLENBQUE7QUFDbkIsQ0FBQyxFQUhXLFNBQVMsS0FBVCxTQUFTLFFBR3BCO0FBT0QsTUFBTSxPQUFPLHFCQUFxQjtJQW9DaEMsWUFDVSxZQUEwQixFQUMxQixpQkFBb0M7UUFEcEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQS9COUMsbUJBQWMsR0FBYyxJQUFJLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVyQyxXQUFNLEdBQTJCO1lBQ3hDLEVBQUUsRUFBRSxlQUFlO1lBQ25CLFNBQVMsRUFBRSxJQUFJLENBQUMsY0FBYztZQUM5QixLQUFLLEVBQUUsT0FBTztZQUNkLElBQUksRUFBRSxNQUFNO1lBQ1osSUFBSSxFQUFFLE1BQU07WUFDWixJQUFJLEVBQUUsT0FBTztZQUNiLFdBQVcsRUFBRSxFQUFFO1NBQ2hCLENBQUM7UUFFRixjQUFTLEdBQTRCLE9BQU8sQ0FBQztRQUM3Qyxv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QU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVc7YUFDMUMsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNsRCxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUNsQixPQUFPO2dCQUNMLEtBQUssRUFBRSxVQUFVO2dCQUNqQixTQUFTLEVBQUUsSUFBSTthQUNoQixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFTCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUc7Z0JBQ3BCO29CQUNFLEtBQUssRUFBRSxrQkFBa0I7b0JBQ3pCLFNBQVMsRUFBRSxLQUFLO2lCQUNqQjthQUNGLENBQUM7U0FDSDtJQUNILENBQUM7O21IQWpMVSxxQkFBcUI7dUdBQXJCLHFCQUFxQixtUUNsRGxDLDhkQW1CQTs0RkQrQmEscUJBQXFCO2tCQUxqQyxTQUFTOytCQUNFLDBCQUEwQjttSUFPZSxpQkFBaUI7c0JBQW5FLFNBQVM7dUJBQUMsbUJBQW1CLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO2dCQU14QyxNQUFNO3NCQUFkLEtBQUs7Z0JBYUcsU0FBUztzQkFBakIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyQ29udGVudENoZWNrZWQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNlY3VyaXR5Q29udGV4dCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW5cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgSUVycm9yUGFpcnMgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvaW50ZXJmYWNlcy9jb21wb25lbnQtY29uZmlncyc7XG5cbmltcG9ydCB7IElJbnB1dENvbXBvbmVudENvbmZpZyB9IGZyb20gJy4uL2lucHV0L2lucHV0LmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICBEU1NpemVzLFxuICBJRmx5b3V0Q29uZmlnLFxuICBJRmx5b3V0T3B0aW9uQ29uZmlnXG59IGZyb20gJy4uLy4uLy4uL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUF1dG9jb21wbGV0ZUNvbXBvbmVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsPzogc3RyaW5nO1xuICBoaW50Pzogc3RyaW5nO1xuICBkZXNjPzogc3RyaW5nO1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgc2l6ZToga2V5b2YgdHlwZW9mIERTU2l6ZXM7XG4gIGZvcm1Hcm91cDogRm9ybUdyb3VwO1xuICBzdWdnZXN0aW9uczogc3RyaW5nW107XG4gIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgZXJyb3JNZXNzYWdlcz86IElFcnJvclBhaXJzW107XG59XG5cbmV4cG9ydCBlbnVtIG1hdGNoVHlwZSB7XG4gIGluZml4ID0gJ2luZml4JyxcbiAgcHJlZml4ID0gJ3ByZWZpeCdcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXJjYy1jbC1saWItYXV0b2NvbXBsZXRlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2F1dG9jb21wbGV0ZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2F1dG9jb21wbGV0ZS5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQXV0b0NvbXBsZXRlQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIEFmdGVyQ29udGVudENoZWNrZWRcbntcbiAgQFZpZXdDaGlsZCgnaW5wdXRBdXRvY29tcGxldGUnLCB7IHN0YXRpYzogZmFsc2UgfSkgaW5wdXRBdXRvY29tcGxldGU6XG4gICAgfCBFbGVtZW50UmVmXG4gICAgfCB1bmRlZmluZWQ7XG5cbiAgZm9ybUdyb3VwRW1wdHk6IEZvcm1Hcm91cCA9IG5ldyBGb3JtR3JvdXAoe30pO1xuXG4gIEBJbnB1dCgpIGNvbmZpZzogSUF1dG9jb21wbGV0ZUNvbXBvbmVudCA9IHtcbiAgICBpZDogJ2F1dG8tY29tcGxldGUnLFxuICAgIGZvcm1Hcm91cDogdGhpcy5mb3JtR3JvdXBFbXB0eSxcbiAgICBsYWJlbDogJ2xhYmVsJyxcbiAgICBoaW50OiAnaGludCcsXG4gICAgZGVzYzogJ2Rlc2MnLFxuICAgIHNpemU6ICdzbWFsbCcsXG4gICAgc3VnZ2VzdGlvbnM6IFtdXG4gIH07XG5cbiAgbWF0Y2hUeXBlPzoga2V5b2YgdHlwZW9mIG1hdGNoVHlwZSA9ICdpbmZpeCc7XG4gIHNob3dTdWdnZXN0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpIGZvcm1Hcm91cCA9IHRoaXMuZm9ybUdyb3VwRW1wdHk7XG5cbiAgaW5wdXRDb21wb25lbnQ6IElJbnB1dENvbXBvbmVudENvbmZpZyA9IHtcbiAgICAuLi50aGlzLmNvbmZpZyxcbiAgICB0eXBlOiAnYXV0b2NvbXBsZXRlJ1xuICB9O1xuXG4gIGZseW91dDogSUZseW91dENvbmZpZyA9IHtcbiAgICBpZDogJ3N0cmluZycsXG4gICAgb3B0aW9uczogW10sXG4gICAgdHlwZTogJ2F1dG9jb21wbGV0ZScsXG4gICAgc2l6ZTogdGhpcy5jb25maWcuc2l6ZVxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZG9tU2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7fVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICB0aGlzLmlucHV0Q29tcG9uZW50ID0ge1xuICAgICAgLi4udGhpcy5jb25maWcsXG4gICAgICB0eXBlOiAnYXV0b2NvbXBsZXRlJ1xuICAgIH07XG5cbiAgICB0aGlzLmZseW91dC5zaXplID0gdGhpcy5jb25maWcuc2l6ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpIHtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLmZvcm1Hcm91cCAhPT0gdGhpcy5mb3JtR3JvdXBFbXB0eSkge1xuICAgICAgdGhpcy5jb25maWcuZm9ybUdyb3VwID0gdGhpcy5mb3JtR3JvdXA7XG4gICAgfVxuXG4gICAgdGhpcy5pbnB1dENvbXBvbmVudC5pZCA9IHRoaXMuY29uZmlnLmlkO1xuICAgIHRoaXMuaW5wdXRDb21wb25lbnQuZm9ybUdyb3VwID0gdGhpcy5jb25maWcuZm9ybUdyb3VwO1xuICAgIHRoaXMuaW5wdXRDb21wb25lbnQubGFiZWwgPSB0aGlzLmNvbmZpZy5sYWJlbDtcbiAgICB0aGlzLmlucHV0Q29tcG9uZW50LmhpbnQgPSB0aGlzLmNvbmZpZy5oaW50O1xuICAgIHRoaXMuaW5wdXRDb21wb25lbnQuZGVzYyA9IHRoaXMuY29uZmlnLmRlc2M7XG4gICAgdGhpcy5pbnB1dENvbXBvbmVudC5zaXplID0gdGhpcy5jb25maWcuc2l6ZTtcbiAgICB0aGlzLmlucHV0Q29tcG9uZW50LmVycm9yTWVzc2FnZXMgPSB0aGlzLmNvbmZpZy5lcnJvck1lc3NhZ2VzO1xuICAgIHRoaXMuaW5wdXRDb21wb25lbnQucGxhY2Vob2xkZXIgPSB0aGlzLmNvbmZpZy5wbGFjZWhvbGRlcjtcblxuICAgIHRoaXMuZmx5b3V0LmlkID0gYCR7dGhpcy5jb25maWcuaWR9LWZseW91dGA7XG5cbiAgICB0aGlzLmZseW91dC5vcHRpb25zID0gdGhpcy5jb25maWcuc3VnZ2VzdGlvbnMubWFwKChzdWdnZXN0aW9uKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogc3VnZ2VzdGlvbixcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgdGhpcy5jb25maWcuZm9ybUdyb3VwXG4gICAgICAuZ2V0KHRoaXMuY29uZmlnLmlkKVxuICAgICAgPy52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkYXRhID09PSBudWxsIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5mbHlvdXQuc2VsZWN0ZWQgPSAnJztcbiAgICAgICAgICB0aGlzLmZseW91dC5vcHRpb25zID0gW107XG4gICAgICAgICAgdGhpcy5mbHlvdXQub3B0aW9ucyA9IHRoaXMuY29uZmlnLnN1Z2dlc3Rpb25zLm1hcCgoc3VnZ2VzdGlvbikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsdWU6IHN1Z2dlc3Rpb24sXG4gICAgICAgICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnZhbGlkYXRlSW50ZXJuYWwoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgdGhpcy5pbnB1dENvbXBvbmVudCA9IHtcbiAgICAgIC4uLnRoaXMuY29uZmlnLFxuICAgICAgdHlwZTogJ2F1dG9jb21wbGV0ZSdcbiAgICB9O1xuICB9XG5cbiAgc3ByZWFkRmx5b3V0T3B0aW9uKHZhbHVlOiBzdHJpbmcpOiBJRmx5b3V0T3B0aW9uQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIG9uRm9jdXMoZXZlbnQ6IGFueSkge1xuICAgIGxldCB0aW1lb3V0VGltZSA9IDA7XG5cbiAgICBpZiAoZXZlbnQgPT09IGZhbHNlKSB7XG4gICAgICB0aW1lb3V0VGltZSA9IDUwMDtcbiAgICB9XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zID0gZXZlbnQ7XG4gICAgfSwgdGltZW91dFRpbWUpO1xuXG4gICAgLy8gU2V0IDFzdCBvcHRpb24gYXMgYWN0aXZlIHdoZW4gb24gZm9jdXNcbiAgICBpZiAodGhpcy5mbHlvdXQub3B0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmZseW91dC5vcHRpb25zWzBdLmFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaXNTZWxlY3RlZChldmVudDogYW55KSB7XG4gICAgaWYgKGV2ZW50ICE9PSBudWxsKSB7XG4gICAgICBjb25zdCB0ZW1wRGl2RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGVtcERpdkVsZW1lbnQuaW5uZXJIVE1MID0gZXZlbnQgfHwgJyc7XG4gICAgICBjb25zdCBjb252ZXJ0ZWRTdHJpbmcgPVxuICAgICAgICB0ZW1wRGl2RWxlbWVudC50ZXh0Q29udGVudCB8fCB0ZW1wRGl2RWxlbWVudC5pbm5lclRleHQgfHwgJyc7XG5cbiAgICAgIHRoaXMuY29uZmlnLmZvcm1Hcm91cC5nZXQodGhpcy5jb25maWcuaWQpPy5zZXRWYWx1ZShjb252ZXJ0ZWRTdHJpbmcpO1xuICAgICAgdGhpcy5zaG93U3VnZ2VzdGlvbnMgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZUludGVybmFsKGRhdGE6IHN0cmluZykge1xuICAgIHRoaXMuZmx5b3V0Lm9wdGlvbnMgPSBbXTtcblxuICAgIGxldCBldmVudFN0cmluZyA9IHRoaXMuZG9tU2FuaXRpemVyLnNhbml0aXplKFxuICAgICAgU2VjdXJpdHlDb250ZXh0LkhUTUwsXG4gICAgICBkYXRhLnJlcGxhY2UoLzxbXj5dKj4vZywgJycpXG4gICAgKTtcblxuICAgIGxldCByZTogUmVnRXhwO1xuXG4gICAgaWYgKHRoaXMubWF0Y2hUeXBlID09PSAnaW5maXgnKSB7XG4gICAgICBjb25zdCBpbmZpeE1hdGNoaW5nID0gbmV3IFJlZ0V4cChgJHtkYXRhfWApO1xuICAgICAgcmUgPSBuZXcgUmVnRXhwKGAke2luZml4TWF0Y2hpbmcuc291cmNlfWAsICdpJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBhcmFncmFwaFN0YXJ0ID0gbmV3IFJlZ0V4cChgXiR7ZGF0YX1gKTtcbiAgICAgIGNvbnN0IHdoaXRlc3BhY2VTdGFydCA9IG5ldyBSZWdFeHAoYFxcXFxzK1xcXFxiJHtkYXRhfVthLXpBLVpdKmApO1xuICAgICAgcmUgPSBuZXcgUmVnRXhwKFxuICAgICAgICBgJHtwYXJhZ3JhcGhTdGFydC5zb3VyY2V9fCR7d2hpdGVzcGFjZVN0YXJ0LnNvdXJjZX1gLFxuICAgICAgICAnaSdcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5mbHlvdXQuc2VsZWN0ZWQgPSBkYXRhO1xuXG4gICAgdGhpcy5mbHlvdXQub3B0aW9ucyA9IHRoaXMuY29uZmlnLnN1Z2dlc3Rpb25zXG4gICAgICAuZmlsdGVyKChzdWdnZXN0aW9uKSA9PiBzdWdnZXN0aW9uLnNlYXJjaChyZSkgPj0gMClcbiAgICAgIC5tYXAoKHN1Z2dlc3Rpb24pID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogc3VnZ2VzdGlvbixcbiAgICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuZmx5b3V0Lm9wdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmZseW91dC5vcHRpb25zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6ICdObyBvcHRpb25zIGZvdW5kJyxcbiAgICAgICAgICBjbGlja2FibGU6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2XG4gICNpbnB1dEF1dG9jb21wbGV0ZVxuICBbYXR0ci5zaXplXT1cImNvbmZpZy5zaXplXCJcbj5cbiAgPGlyY2MtY2wtbGliLWlucHV0XG4gICAgW2F0dHIuc2l6ZV09XCJjb25maWcuc2l6ZVwiXG4gICAgW2NvbmZpZ109XCJpbnB1dENvbXBvbmVudFwiXG4gICAgdHlwZT1cImF1dG9jb21wbGV0ZVwiXG4gICAgKGZvY3VzRXZlbnQpPVwib25Gb2N1cygkZXZlbnQpXCJcbiAgPjwvaXJjYy1jbC1saWItaW5wdXQ+XG5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInNob3dTdWdnZXN0aW9ucyA9PT0gdHJ1ZVwiPlxuICAgIDxpcmNjLWNsLWxpYi1mbHlvdXRcbiAgICAgIChpc1NlbGVjdGVkKT1cImlzU2VsZWN0ZWQoJGV2ZW50KVwiXG4gICAgICBbY29uZmlnXT1cImZseW91dFwiXG4gICAgICBbY2xhc3NdPVwiY29uZmlnLnNpemVcIlxuICAgID48L2lyY2MtY2wtbGliLWZseW91dD5cbiAgPC9uZy1jb250YWluZXI+XG48L2Rpdj5cbiJdfQ==