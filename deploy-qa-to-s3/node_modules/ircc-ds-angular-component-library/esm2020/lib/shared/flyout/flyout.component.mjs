import { Component, Input, Output, EventEmitter, HostListener, ViewChildren, QueryList } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
import * as i2 from "@angular/common";
import * as i3 from "@angular/cdk/scrolling";
import * as i4 from "@angular/cdk-experimental/scrolling";
import * as i5 from "../flyout-option/flyout-option.component";
import * as i6 from "../../../shared/pipes/autocomplete.pipe";
export var IFlyoutSelectTypes;
(function (IFlyoutSelectTypes) {
    IFlyoutSelectTypes["single"] = "single";
    IFlyoutSelectTypes["multi"] = "multi";
    IFlyoutSelectTypes["autocomplete"] = "autocomplete";
})(IFlyoutSelectTypes || (IFlyoutSelectTypes = {}));
export const FLYOUT_CURRENT_SELECTED = {
    en: ' currently selected',
    fr: ' actuellement selectionne'
};
export class FlyoutComponent {
    constructor(translate) {
        this.translate = translate;
        this.optionContainers = new QueryList();
        this.config = {
            id: '',
            options: []
        };
        //TODO: Must add the other config parameters
        this.isSelected = new EventEmitter();
        this.selectedIndex = -1;
        this.a11yText = '';
        this.currentSelected = '';
    }
    ngOnInit() {
        if (this.config.type === undefined)
            this.config.type = 'single';
        if (this.config.selected === undefined)
            this.config.selected = '';
        if (this.id)
            this.config.id = this.id;
        if (this.options)
            this.config.options = this.options;
        if (!this.config.options)
            this.config.options = [];
        if (this.disabled)
            this.config.disabled = this.disabled;
        if (this.selection)
            this.config.selection = this.selection;
        if (this.type)
            this.config.type = this.type;
        if (this.size)
            this.config.size = this.size;
        this.setLang(this.translate.currentLang);
        this.translate.onLangChange.subscribe((change) => {
            this.setLang(change.lang);
        });
    }
    calculateContainerHeight() {
        let numberOfItems = this.config.options?.length || 0;
        const itemHeight = 36;
        const visibleItems = 5;
        if (numberOfItems < 2) {
            numberOfItems = 1.5;
        }
        if (numberOfItems && numberOfItems <= visibleItems) {
            return `${itemHeight * numberOfItems}px`;
        }
        return `${itemHeight * visibleItems}px`;
    }
    onClick(event) {
        let target = event.target;
        if (!target.classList.contains('option-contents') &&
            !target.classList.contains('dropdown')) {
            this.isSelected.emit(null);
        }
    }
    onArrowDown(event) {
        event.preventDefault();
        if (this.config.options) {
            let foundClickable = false;
            this.config.options
                .slice(this.selectedIndex + 1)
                .forEach((option, index) => {
                if (!foundClickable && option.clickable !== false) {
                    this.selectedIndex += index + 1;
                    this.highlightIndex(option.id);
                    foundClickable = true;
                }
            });
        }
    }
    onArrowUp(event) {
        event.preventDefault();
        if (this.config.options) {
            let foundClickable = false;
            this.config.options
                .slice(0, this.selectedIndex)
                .reverse()
                .forEach((option, index) => {
                if (!foundClickable && option.clickable !== false) {
                    this.selectedIndex -= index + 1;
                    this.highlightIndex(option.id);
                    foundClickable = true;
                }
            });
            // Ensure selectedIndex does not fall below 0
            this.selectedIndex = Math.max(this.selectedIndex, 0);
        }
    }
    onEnter(event) {
        event.preventDefault();
        //if the index hasn't changes through arrow navigation, emits our event but lets the parent know nothing was selected
        this.selectedIndex != -1
            ? this.optionSelected(this.selectedIndex)
            : this.isSelected.emit(null);
    }
    onHover() {
        // Remove default active state for 1st option when user hover on flyout
        if (this.config.options.length > 0 &&
            this.config.options[0].active === true)
            this.config.options[0].active = false;
    }
    //takes in the active index from HostListeners and sets the config option to active state which triggers styling
    highlightIndex(el_id) {
        if (el_id) {
            this.config.options?.forEach((option) => {
                if (option.id === el_id) {
                    option.active = true;
                    this.optionContainers
                        .toArray()[this.selectedIndex]?.nativeElement?.scrollIntoView({
                        behavior: 'smooth',
                        block: 'end'
                    });
                    console.log('HERE', option.value);
                    this.a11yText = option.value;
                    //updates a11yText to indicate currently selected item if scrolling through flyout again
                    if (option.selected)
                        this.a11yText += this.currentSelected;
                }
                else {
                    option.active = false;
                }
            });
        }
    }
    /**
     * setLang detects changes to the language toggle to serve the correct aria error text
     */
    setLang(lang) {
        lang === 'en' || lang === 'en-US'
            ? (this.currentSelected = FLYOUT_CURRENT_SELECTED.en)
            : (this.currentSelected = FLYOUT_CURRENT_SELECTED.fr);
    }
    //clears all selections by setting the option.selected to false
    clearOptions() {
        this.config?.options?.forEach((option) => {
            option.selected = false;
        });
    }
    //function takes in index value of current active option and selects it
    optionSelected(i) {
        if (this.config.options &&
            !this.config.options[i].selected &&
            this.config.options[i].clickable) {
            //setup for future multi select feature
            this.config.type !== 'multi'
                ? this.clearOptions()
                : /*this.config.selection = [].push(this.config.options[i]);*/ console.log('MULTI');
            this.config.options[i].selected = true;
            //emits the value of the selected index so it's visible to the parent
            this.isSelected.emit(this.config.options[i].value);
        }
    }
}
FlyoutComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: FlyoutComponent, deps: [{ token: i1.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
FlyoutComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.12", type: FlyoutComponent, selector: "ircc-cl-lib-flyout", inputs: { config: "config", id: "id", options: "options", disabled: "disabled", selection: "selection", type: "type", size: "size" }, outputs: { isSelected: "isSelected" }, host: { listeners: { "document:click": "onClick($event)", "document:keydown.arrowdown": "onArrowDown($event)", "document:keydown.arrowup": "onArrowUp($event)", "document:keydown.enter": "onEnter($event)", "mouseenter": "onHover()" } }, viewQueries: [{ propertyName: "optionContainers", predicate: ["option"], descendants: true }], ngImport: i0, template: "<div\n  *ngIf=\"\n    config.type !== 'autocomplete' || config.options.length < 50;\n    else auto_flyout\n  \"\n>\n  <div\n    class=\"{{ config?.size }} flyout-container\"\n    #container\n  >\n    <div\n      #option\n      *ngFor=\"let option of config?.options; let index = index\"\n      [ngClass]=\"{\n        'flyout-option-container': option.clickable !== false,\n        'disabled-option': option.disabled === true,\n        selected: option.active\n      }\"\n    >\n      <ircc-cl-lib-flyout-option\n        [config]=\"option\"\n        [value]=\"option.value | autocomplete : config.selected\"\n        [size]=\"option.size\"\n        (click)=\"optionSelected(index)\"\n        [id]=\"option.id + '_option_' + (index + 1)\"\n      ></ircc-cl-lib-flyout-option>\n    </div>\n  </div>\n</div>\n\n<ng-template #auto_flyout>\n  <div class=\"{{ config?.size }} flyout-container\">\n    <cdk-virtual-scroll-viewport\n      autosize\n      style=\"height: 100%\"\n      minBufferPx=\"5\"\n      maxBufferPx=\"56\"\n      class=\"example-viewport\"\n      #container\n      [style.height]=\"calculateContainerHeight()\"\n    >\n      <div\n        *cdkVirtualFor=\"\n          let option of config?.options;\n          let index = index;\n          templateCacheSize: 0\n        \"\n        class=\"example-item\"\n        [ngClass]=\"{\n          'flyout-option-container': option.clickable !== false,\n          'disabled-option': option.disabled === true,\n          selected: option.active\n        }\"\n      >\n        <ircc-cl-lib-flyout-option\n          [config]=\"option\"\n          [value]=\"option.value | autocomplete : config.selected\"\n          [size]=\"option.size\"\n          (click)=\"optionSelected(index)\"\n          [id]=\"option.id + '_option_' + (index + 1)\"\n        ></ircc-cl-lib-flyout-option>\n      </div>\n    </cdk-virtual-scroll-viewport>\n  </div>\n</ng-template>\n\n<ng-template\n  #options\n  let-config=\"config\"\n  let-index=\"index\"\n>\n  <ircc-cl-lib-flyout-option\n    [config]=\"config\"\n    [value]=\"config.value | autocomplete : this.config.selected\"\n    [size]=\"config.size\"\n    (click)=\"optionSelected(index)\"\n    [id]=\"config.id + '_option_' + (index + 1)\"\n  ></ircc-cl-lib-flyout-option>\n</ng-template>\n<span\n  id=\"sr\"\n  class=\"sr-only\"\n  aria-live=\"polite\"\n  >{{ a11yText }}{{ currentSelected }}</span\n>\n", dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.CdkVirtualForOf, selector: "[cdkVirtualFor][cdkVirtualForOf]", inputs: ["cdkVirtualForOf", "cdkVirtualForTrackBy", "cdkVirtualForTemplate", "cdkVirtualForTemplateCacheSize"] }, { kind: "component", type: i3.CdkVirtualScrollViewport, selector: "cdk-virtual-scroll-viewport", inputs: ["orientation", "appendOnly"], outputs: ["scrolledIndexChange"] }, { kind: "directive", type: i4.CdkAutoSizeVirtualScroll, selector: "cdk-virtual-scroll-viewport[autosize]", inputs: ["minBufferPx", "maxBufferPx"] }, { kind: "component", type: i5.FlyoutOptionComponent, selector: "ircc-cl-lib-flyout-option", inputs: ["config", "id", "size", "value", "selected", "active", "disabled", "type", "clickable"] }, { kind: "pipe", type: i6.autocompletePipe, name: "autocomplete" }], preserveWhitespaces: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: FlyoutComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ircc-cl-lib-flyout', template: "<div\n  *ngIf=\"\n    config.type !== 'autocomplete' || config.options.length < 50;\n    else auto_flyout\n  \"\n>\n  <div\n    class=\"{{ config?.size }} flyout-container\"\n    #container\n  >\n    <div\n      #option\n      *ngFor=\"let option of config?.options; let index = index\"\n      [ngClass]=\"{\n        'flyout-option-container': option.clickable !== false,\n        'disabled-option': option.disabled === true,\n        selected: option.active\n      }\"\n    >\n      <ircc-cl-lib-flyout-option\n        [config]=\"option\"\n        [value]=\"option.value | autocomplete : config.selected\"\n        [size]=\"option.size\"\n        (click)=\"optionSelected(index)\"\n        [id]=\"option.id + '_option_' + (index + 1)\"\n      ></ircc-cl-lib-flyout-option>\n    </div>\n  </div>\n</div>\n\n<ng-template #auto_flyout>\n  <div class=\"{{ config?.size }} flyout-container\">\n    <cdk-virtual-scroll-viewport\n      autosize\n      style=\"height: 100%\"\n      minBufferPx=\"5\"\n      maxBufferPx=\"56\"\n      class=\"example-viewport\"\n      #container\n      [style.height]=\"calculateContainerHeight()\"\n    >\n      <div\n        *cdkVirtualFor=\"\n          let option of config?.options;\n          let index = index;\n          templateCacheSize: 0\n        \"\n        class=\"example-item\"\n        [ngClass]=\"{\n          'flyout-option-container': option.clickable !== false,\n          'disabled-option': option.disabled === true,\n          selected: option.active\n        }\"\n      >\n        <ircc-cl-lib-flyout-option\n          [config]=\"option\"\n          [value]=\"option.value | autocomplete : config.selected\"\n          [size]=\"option.size\"\n          (click)=\"optionSelected(index)\"\n          [id]=\"option.id + '_option_' + (index + 1)\"\n        ></ircc-cl-lib-flyout-option>\n      </div>\n    </cdk-virtual-scroll-viewport>\n  </div>\n</ng-template>\n\n<ng-template\n  #options\n  let-config=\"config\"\n  let-index=\"index\"\n>\n  <ircc-cl-lib-flyout-option\n    [config]=\"config\"\n    [value]=\"config.value | autocomplete : this.config.selected\"\n    [size]=\"config.size\"\n    (click)=\"optionSelected(index)\"\n    [id]=\"config.id + '_option_' + (index + 1)\"\n  ></ircc-cl-lib-flyout-option>\n</ng-template>\n<span\n  id=\"sr\"\n  class=\"sr-only\"\n  aria-live=\"polite\"\n  >{{ a11yText }}{{ currentSelected }}</span\n>\n" }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }]; }, propDecorators: { optionContainers: [{
                type: ViewChildren,
                args: ['option']
            }], config: [{
                type: Input
            }], id: [{
                type: Input
            }], options: [{
                type: Input
            }], disabled: [{
                type: Input
            }], selection: [{
                type: Input
            }], type: [{
                type: Input
            }], size: [{
                type: Input
            }], isSelected: [{
                type: Output
            }], onClick: [{
                type: HostListener,
                args: ['document:click', ['$event']]
            }], onArrowDown: [{
                type: HostListener,
                args: ['document:keydown.arrowdown', ['$event']]
            }], onArrowUp: [{
                type: HostListener,
                args: ['document:keydown.arrowup', ['$event']]
            }], onEnter: [{
                type: HostListener,
                args: ['document:keydown.enter', ['$event']]
            }], onHover: [{
                type: HostListener,
                args: ['mouseenter']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmx5b3V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2NvbXBvbmVudC1saWIvc3JjL2xpYi9zaGFyZWQvZmx5b3V0L2ZseW91dC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9jb21wb25lbnQtbGliL3NyYy9saWIvc2hhcmVkL2ZseW91dC9mbHlvdXQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUVOLFlBQVksRUFDWixZQUFZLEVBQ1osWUFBWSxFQUVaLFNBQVMsRUFHVixNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7QUFRdkIsTUFBTSxDQUFOLElBQVksa0JBSVg7QUFKRCxXQUFZLGtCQUFrQjtJQUM1Qix1Q0FBaUIsQ0FBQTtJQUNqQixxQ0FBZSxDQUFBO0lBQ2YsbURBQTZCLENBQUE7QUFDL0IsQ0FBQyxFQUpXLGtCQUFrQixLQUFsQixrQkFBa0IsUUFJN0I7QUFXRCxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRztJQUNyQyxFQUFFLEVBQUUscUJBQXFCO0lBQ3pCLEVBQUUsRUFBRSwyQkFBMkI7Q0FDaEMsQ0FBQztBQU1GLE1BQU0sT0FBTyxlQUFlO0lBQzFCLFlBQW9CLFNBQTJCO1FBQTNCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQ3ZCLHFCQUFnQixHQUN0QyxJQUFJLFNBQVMsRUFBYyxDQUFDO1FBRXJCLFdBQU0sR0FBa0I7WUFDL0IsRUFBRSxFQUFFLEVBQUU7WUFDTixPQUFPLEVBQUUsRUFBRTtTQUNaLENBQUM7UUFRRiw0Q0FBNEM7UUFDbEMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFFMUMsa0JBQWEsR0FBVyxDQUFDLENBQUMsQ0FBQztRQUMzQixhQUFRLEdBQVcsRUFBRSxDQUFDO1FBQ3RCLG9CQUFlLEdBQVcsRUFBRSxDQUFDO0lBcEJxQixDQUFDO0lB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LHFFQUFxRTtZQUNyRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNwRDtJQUNILENBQUM7OzZHQXBMVSxlQUFlO2lHQUFmLGVBQWUsa2pCQzVDNUIsMDFFQXFGQTs0RkR6Q2EsZUFBZTtrQkFKM0IsU0FBUzsrQkFDRSxvQkFBb0I7dUdBS04sZ0JBQWdCO3NCQUF2QyxZQUFZO3VCQUFDLFFBQVE7Z0JBR2IsTUFBTTtzQkFBZCxLQUFLO2dCQUlHLEVBQUU7c0JBQVYsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLElBQUk7c0JBQVosS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBR0ksVUFBVTtzQkFBbkIsTUFBTTtnQkF3Q1AsT0FBTztzQkFETixZQUFZO3VCQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDO2dCQVkxQyxXQUFXO3NCQURWLFlBQVk7dUJBQUMsNEJBQTRCLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBa0J0RCxTQUFTO3NCQURSLFlBQVk7dUJBQUMsMEJBQTBCLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBcUJwRCxPQUFPO3NCQUROLFlBQVk7dUJBQUMsd0JBQXdCLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBVWxELE9BQU87c0JBRE4sWUFBWTt1QkFBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBPbkluaXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBWaWV3Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIFF1ZXJ5TGlzdCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRFNTaXplcyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9jb25zdGFudHMvamwtY29tcG9uZW50cy5jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgRmx5b3V0T3B0aW9uQ29tcG9uZW50LFxuICBJRmx5b3V0T3B0aW9uQ29uZmlnXG59IGZyb20gJy4uL2ZseW91dC1vcHRpb24vZmx5b3V0LW9wdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuXG5leHBvcnQgZW51bSBJRmx5b3V0U2VsZWN0VHlwZXMge1xuICBzaW5nbGUgPSAnc2luZ2xlJyxcbiAgbXVsdGkgPSAnbXVsdGknLFxuICBhdXRvY29tcGxldGUgPSAnYXV0b2NvbXBsZXRlJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElGbHlvdXRDb25maWcge1xuICBpZDogc3RyaW5nO1xuICBvcHRpb25zOiBJRmx5b3V0T3B0aW9uQ29uZmlnW107XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgc2VsZWN0ZWQ/OiBzdHJpbmc7XG4gIHNlbGVjdGlvbj86IFtdIHwgbnVtYmVyO1xuICB0eXBlPzoga2V5b2YgdHlwZW9mIElGbHlvdXRTZWxlY3RUeXBlcztcbiAgc2l6ZT86IGtleW9mIHR5cGVvZiBEU1NpemVzO1xufVxuZXhwb3J0IGNvbnN0IEZMWU9VVF9DVVJSRU5UX1NFTEVDVEVEID0ge1xuICBlbjogJyBjdXJyZW50bHkgc2VsZWN0ZWQnLFxuICBmcjogJyBhY3R1ZWxsZW1lbnQgc2VsZWN0aW9ubmUnXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpcmNjLWNsLWxpYi1mbHlvdXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZmx5b3V0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBGbHlvdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSkge31cbiAgQFZpZXdDaGlsZHJlbignb3B0aW9uJykgb3B0aW9uQ29udGFpbmVyczogUXVlcnlMaXN0PEVsZW1lbnRSZWY+ID1cbiAgICBuZXcgUXVlcnlMaXN0PEVsZW1lbnRSZWY+KCk7XG5cbiAgQElucHV0KCkgY29uZmlnOiBJRmx5b3V0Q29uZmlnID0ge1xuICAgIGlkOiAnJyxcbiAgICBvcHRpb25zOiBbXVxuICB9O1xuICBASW5wdXQoKSBpZD86IHN0cmluZztcbiAgQElucHV0KCkgb3B0aW9ucz86IElGbHlvdXRPcHRpb25Db25maWdbXTtcbiAgQElucHV0KCkgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBASW5wdXQoKSBzZWxlY3Rpb24/OiBbXSB8IG51bWJlcjtcbiAgQElucHV0KCkgdHlwZT86IGtleW9mIHR5cGVvZiBJRmx5b3V0U2VsZWN0VHlwZXM7XG4gIEBJbnB1dCgpIHNpemU/OiBrZXlvZiB0eXBlb2YgRFNTaXplcztcblxuICAvL1RPRE86IE11c3QgYWRkIHRoZSBvdGhlciBjb25maWcgcGFyYW1ldGVyc1xuICBAT3V0cHV0KCkgaXNTZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBzZWxlY3RlZEluZGV4OiBudW1iZXIgPSAtMTtcbiAgYTExeVRleHQ6IHN0cmluZyA9ICcnO1xuICBjdXJyZW50U2VsZWN0ZWQ6IHN0cmluZyA9ICcnO1xuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLmNvbmZpZy50eXBlID09PSB1bmRlZmluZWQpIHRoaXMuY29uZmlnLnR5cGUgPSAnc2luZ2xlJztcbiAgICBpZiAodGhpcy5jb25maWcuc2VsZWN0ZWQgPT09IHVuZGVmaW5lZCkgdGhpcy5jb25maWcuc2VsZWN0ZWQgPSAnJztcbiAgICBpZiAodGhpcy5pZCkgdGhpcy5jb25maWcuaWQgPSB0aGlzLmlkO1xuICAgIGlmICh0aGlzLm9wdGlvbnMpIHRoaXMuY29uZmlnLm9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5vcHRpb25zKSB0aGlzLmNvbmZpZy5vcHRpb25zID0gW107XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHRoaXMuY29uZmlnLmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZDtcbiAgICBpZiAodGhpcy5zZWxlY3Rpb24pIHRoaXMuY29uZmlnLnNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uO1xuICAgIGlmICh0aGlzLnR5cGUpIHRoaXMuY29uZmlnLnR5cGUgPSB0aGlzLnR5cGU7XG4gICAgaWYgKHRoaXMuc2l6ZSkgdGhpcy5jb25maWcuc2l6ZSA9IHRoaXMuc2l6ZTtcblxuICAgIHRoaXMuc2V0TGFuZyh0aGlzLnRyYW5zbGF0ZS5jdXJyZW50TGFuZyk7XG4gICAgdGhpcy50cmFuc2xhdGUub25MYW5nQ2hhbmdlLnN1YnNjcmliZSgoY2hhbmdlKSA9PiB7XG4gICAgICB0aGlzLnNldExhbmcoY2hhbmdlLmxhbmcpO1xuICAgIH0pO1xuICB9XG5cbiAgY2FsY3VsYXRlQ29udGFpbmVySGVpZ2h0KCk6IHN0cmluZyB7XG4gICAgbGV0IG51bWJlck9mSXRlbXMgPSB0aGlzLmNvbmZpZy5vcHRpb25zPy5sZW5ndGggfHwgMDtcbiAgICBjb25zdCBpdGVtSGVpZ2h0ID0gMzY7XG4gICAgY29uc3QgdmlzaWJsZUl0ZW1zID0gNTtcblxuICAgIGlmIChudW1iZXJPZkl0ZW1zIDwgMikge1xuICAgICAgbnVtYmVyT2ZJdGVtcyA9IDEuNTtcbiAgICB9XG5cbiAgICBpZiAobnVtYmVyT2ZJdGVtcyAmJiBudW1iZXJPZkl0ZW1zIDw9IHZpc2libGVJdGVtcykge1xuICAgICAgcmV0dXJuIGAke2l0ZW1IZWlnaHQgKiBudW1iZXJPZkl0ZW1zfXB4YDtcbiAgICB9XG5cbiAgICByZXR1cm4gYCR7aXRlbUhlaWdodCAqIHZpc2libGVJdGVtc31weGA7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpjbGljaycsIFsnJGV2ZW50J10pXG4gIG9uQ2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgbGV0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICBpZiAoXG4gICAgICAhdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnb3B0aW9uLWNvbnRlbnRzJykgJiZcbiAgICAgICF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcm9wZG93bicpXG4gICAgKSB7XG4gICAgICB0aGlzLmlzU2VsZWN0ZWQuZW1pdChudWxsKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duLmFycm93ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uQXJyb3dEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAodGhpcy5jb25maWcub3B0aW9ucykge1xuICAgICAgbGV0IGZvdW5kQ2xpY2thYmxlID0gZmFsc2U7XG4gICAgICB0aGlzLmNvbmZpZy5vcHRpb25zXG4gICAgICAgIC5zbGljZSh0aGlzLnNlbGVjdGVkSW5kZXggKyAxKVxuICAgICAgICAuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGlmICghZm91bmRDbGlja2FibGUgJiYgb3B0aW9uLmNsaWNrYWJsZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCArPSBpbmRleCArIDE7XG4gICAgICAgICAgICB0aGlzLmhpZ2hsaWdodEluZGV4KG9wdGlvbi5pZCk7XG4gICAgICAgICAgICBmb3VuZENsaWNrYWJsZSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duLmFycm93dXAnLCBbJyRldmVudCddKVxuICBvbkFycm93VXAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICh0aGlzLmNvbmZpZy5vcHRpb25zKSB7XG4gICAgICBsZXQgZm91bmRDbGlja2FibGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuY29uZmlnLm9wdGlvbnNcbiAgICAgICAgLnNsaWNlKDAsIHRoaXMuc2VsZWN0ZWRJbmRleClcbiAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGlmICghZm91bmRDbGlja2FibGUgJiYgb3B0aW9uLmNsaWNrYWJsZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCAtPSBpbmRleCArIDE7XG4gICAgICAgICAgICB0aGlzLmhpZ2hsaWdodEluZGV4KG9wdGlvbi5pZCk7XG4gICAgICAgICAgICBmb3VuZENsaWNrYWJsZSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIC8vIEVuc3VyZSBzZWxlY3RlZEluZGV4IGRvZXMgbm90IGZhbGwgYmVsb3cgMFxuICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gTWF0aC5tYXgodGhpcy5zZWxlY3RlZEluZGV4LCAwKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duLmVudGVyJywgWyckZXZlbnQnXSlcbiAgb25FbnRlcihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy9pZiB0aGUgaW5kZXggaGFzbid0IGNoYW5nZXMgdGhyb3VnaCBhcnJvdyBuYXZpZ2F0aW9uLCBlbWl0cyBvdXIgZXZlbnQgYnV0IGxldHMgdGhlIHBhcmVudCBrbm93IG5vdGhpbmcgd2FzIHNlbGVjdGVkXG4gICAgdGhpcy5zZWxlY3RlZEluZGV4ICE9IC0xXG4gICAgICA/IHRoaXMub3B0aW9uU2VsZWN0ZWQodGhpcy5zZWxlY3RlZEluZGV4KVxuICAgICAgOiB0aGlzLmlzU2VsZWN0ZWQuZW1pdChudWxsKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuICBvbkhvdmVyKCkge1xuICAgIC8vIFJlbW92ZSBkZWZhdWx0IGFjdGl2ZSBzdGF0ZSBmb3IgMXN0IG9wdGlvbiB3aGVuIHVzZXIgaG92ZXIgb24gZmx5b3V0XG4gICAgaWYgKFxuICAgICAgdGhpcy5jb25maWcub3B0aW9ucy5sZW5ndGggPiAwICYmXG4gICAgICB0aGlzLmNvbmZpZy5vcHRpb25zWzBdLmFjdGl2ZSA9PT0gdHJ1ZVxuICAgIClcbiAgICAgIHRoaXMuY29uZmlnLm9wdGlvbnNbMF0uYWN0aXZlID0gZmFsc2U7XG4gIH1cblxuICAvL3Rha2VzIGluIHRoZSBhY3RpdmUgaW5kZXggZnJvbSBIb3N0TGlzdGVuZXJzIGFuZCBzZXRzIHRoZSBjb25maWcgb3B0aW9uIHRvIGFjdGl2ZSBzdGF0ZSB3aGljaCB0cmlnZ2VycyBzdHlsaW5nXG4gIGhpZ2hsaWdodEluZGV4KGVsX2lkOiBhbnkpIHtcbiAgICBpZiAoZWxfaWQpIHtcbiAgICAgIHRoaXMuY29uZmlnLm9wdGlvbnM/LmZvckVhY2goKG9wdGlvbikgPT4ge1xuICAgICAgICBpZiAob3B0aW9uLmlkID09PSBlbF9pZCkge1xuICAgICAgICAgIG9wdGlvbi5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMub3B0aW9uQ29udGFpbmVyc1xuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgW3RoaXMuc2VsZWN0ZWRJbmRleF0/Lm5hdGl2ZUVsZW1lbnQ/LnNjcm9sbEludG9WaWV3KHtcbiAgICAgICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxuICAgICAgICAgICAgICBibG9jazogJ2VuZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdIRVJFJywgb3B0aW9uLnZhbHVlKTtcblxuICAgICAgICAgIHRoaXMuYTExeVRleHQgPSBvcHRpb24udmFsdWU7XG4gICAgICAgICAgLy91cGRhdGVzIGExMXlUZXh0IHRvIGluZGljYXRlIGN1cnJlbnRseSBzZWxlY3RlZCBpdGVtIGlmIHNjcm9sbGluZyB0aHJvdWdoIGZseW91dCBhZ2FpblxuICAgICAgICAgIGlmIChvcHRpb24uc2VsZWN0ZWQpIHRoaXMuYTExeVRleHQgKz0gdGhpcy5jdXJyZW50U2VsZWN0ZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3B0aW9uLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogc2V0TGFuZyBkZXRlY3RzIGNoYW5nZXMgdG8gdGhlIGxhbmd1YWdlIHRvZ2dsZSB0byBzZXJ2ZSB0aGUgY29ycmVjdCBhcmlhIGVycm9yIHRleHRcbiAgICovXG4gIHNldExhbmcobGFuZzogc3RyaW5nKSB7XG4gICAgbGFuZyA9PT0gJ2VuJyB8fCBsYW5nID09PSAnZW4tVVMnXG4gICAgICA/ICh0aGlzLmN1cnJlbnRTZWxlY3RlZCA9IEZMWU9VVF9DVVJSRU5UX1NFTEVDVEVELmVuKVxuICAgICAgOiAodGhpcy5jdXJyZW50U2VsZWN0ZWQgPSBGTFlPVVRfQ1VSUkVOVF9TRUxFQ1RFRC5mcik7XG4gIH1cblxuICAvL2NsZWFycyBhbGwgc2VsZWN0aW9ucyBieSBzZXR0aW5nIHRoZSBvcHRpb24uc2VsZWN0ZWQgdG8gZmFsc2VcbiAgY2xlYXJPcHRpb25zKCkge1xuICAgIHRoaXMuY29uZmlnPy5vcHRpb25zPy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgLy9mdW5jdGlvbiB0YWtlcyBpbiBpbmRleCB2YWx1ZSBvZiBjdXJyZW50IGFjdGl2ZSBvcHRpb24gYW5kIHNlbGVjdHMgaXRcbiAgb3B0aW9uU2VsZWN0ZWQoaTogbnVtYmVyKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5jb25maWcub3B0aW9ucyAmJlxuICAgICAgIXRoaXMuY29uZmlnLm9wdGlvbnNbaV0uc2VsZWN0ZWQgJiZcbiAgICAgIHRoaXMuY29uZmlnLm9wdGlvbnNbaV0uY2xpY2thYmxlXG4gICAgKSB7XG4gICAgICAvL3NldHVwIGZvciBmdXR1cmUgbXVsdGkgc2VsZWN0IGZlYXR1cmVcbiAgICAgIHRoaXMuY29uZmlnLnR5cGUgIT09ICdtdWx0aSdcbiAgICAgICAgPyB0aGlzLmNsZWFyT3B0aW9ucygpXG4gICAgICAgIDogLyp0aGlzLmNvbmZpZy5zZWxlY3Rpb24gPSBbXS5wdXNoKHRoaXMuY29uZmlnLm9wdGlvbnNbaV0pOyovIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgJ01VTFRJJ1xuICAgICAgICAgICk7XG4gICAgICB0aGlzLmNvbmZpZy5vcHRpb25zW2ldLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgIC8vZW1pdHMgdGhlIHZhbHVlIG9mIHRoZSBzZWxlY3RlZCBpbmRleCBzbyBpdCdzIHZpc2libGUgdG8gdGhlIHBhcmVudFxuICAgICAgdGhpcy5pc1NlbGVjdGVkLmVtaXQodGhpcy5jb25maWcub3B0aW9uc1tpXS52YWx1ZSk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2XG4gICpuZ0lmPVwiXG4gICAgY29uZmlnLnR5cGUgIT09ICdhdXRvY29tcGxldGUnIHx8IGNvbmZpZy5vcHRpb25zLmxlbmd0aCA8IDUwO1xuICAgIGVsc2UgYXV0b19mbHlvdXRcbiAgXCJcbj5cbiAgPGRpdlxuICAgIGNsYXNzPVwie3sgY29uZmlnPy5zaXplIH19IGZseW91dC1jb250YWluZXJcIlxuICAgICNjb250YWluZXJcbiAgPlxuICAgIDxkaXZcbiAgICAgICNvcHRpb25cbiAgICAgICpuZ0Zvcj1cImxldCBvcHRpb24gb2YgY29uZmlnPy5vcHRpb25zOyBsZXQgaW5kZXggPSBpbmRleFwiXG4gICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICdmbHlvdXQtb3B0aW9uLWNvbnRhaW5lcic6IG9wdGlvbi5jbGlja2FibGUgIT09IGZhbHNlLFxuICAgICAgICAnZGlzYWJsZWQtb3B0aW9uJzogb3B0aW9uLmRpc2FibGVkID09PSB0cnVlLFxuICAgICAgICBzZWxlY3RlZDogb3B0aW9uLmFjdGl2ZVxuICAgICAgfVwiXG4gICAgPlxuICAgICAgPGlyY2MtY2wtbGliLWZseW91dC1vcHRpb25cbiAgICAgICAgW2NvbmZpZ109XCJvcHRpb25cIlxuICAgICAgICBbdmFsdWVdPVwib3B0aW9uLnZhbHVlIHwgYXV0b2NvbXBsZXRlIDogY29uZmlnLnNlbGVjdGVkXCJcbiAgICAgICAgW3NpemVdPVwib3B0aW9uLnNpemVcIlxuICAgICAgICAoY2xpY2spPVwib3B0aW9uU2VsZWN0ZWQoaW5kZXgpXCJcbiAgICAgICAgW2lkXT1cIm9wdGlvbi5pZCArICdfb3B0aW9uXycgKyAoaW5kZXggKyAxKVwiXG4gICAgICA+PC9pcmNjLWNsLWxpYi1mbHlvdXQtb3B0aW9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2F1dG9fZmx5b3V0PlxuICA8ZGl2IGNsYXNzPVwie3sgY29uZmlnPy5zaXplIH19IGZseW91dC1jb250YWluZXJcIj5cbiAgICA8Y2RrLXZpcnR1YWwtc2Nyb2xsLXZpZXdwb3J0XG4gICAgICBhdXRvc2l6ZVxuICAgICAgc3R5bGU9XCJoZWlnaHQ6IDEwMCVcIlxuICAgICAgbWluQnVmZmVyUHg9XCI1XCJcbiAgICAgIG1heEJ1ZmZlclB4PVwiNTZcIlxuICAgICAgY2xhc3M9XCJleGFtcGxlLXZpZXdwb3J0XCJcbiAgICAgICNjb250YWluZXJcbiAgICAgIFtzdHlsZS5oZWlnaHRdPVwiY2FsY3VsYXRlQ29udGFpbmVySGVpZ2h0KClcIlxuICAgID5cbiAgICAgIDxkaXZcbiAgICAgICAgKmNka1ZpcnR1YWxGb3I9XCJcbiAgICAgICAgICBsZXQgb3B0aW9uIG9mIGNvbmZpZz8ub3B0aW9ucztcbiAgICAgICAgICBsZXQgaW5kZXggPSBpbmRleDtcbiAgICAgICAgICB0ZW1wbGF0ZUNhY2hlU2l6ZTogMFxuICAgICAgICBcIlxuICAgICAgICBjbGFzcz1cImV4YW1wbGUtaXRlbVwiXG4gICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAnZmx5b3V0LW9wdGlvbi1jb250YWluZXInOiBvcHRpb24uY2xpY2thYmxlICE9PSBmYWxzZSxcbiAgICAgICAgICAnZGlzYWJsZWQtb3B0aW9uJzogb3B0aW9uLmRpc2FibGVkID09PSB0cnVlLFxuICAgICAgICAgIHNlbGVjdGVkOiBvcHRpb24uYWN0aXZlXG4gICAgICAgIH1cIlxuICAgICAgPlxuICAgICAgICA8aXJjYy1jbC1saWItZmx5b3V0LW9wdGlvblxuICAgICAgICAgIFtjb25maWddPVwib3B0aW9uXCJcbiAgICAgICAgICBbdmFsdWVdPVwib3B0aW9uLnZhbHVlIHwgYXV0b2NvbXBsZXRlIDogY29uZmlnLnNlbGVjdGVkXCJcbiAgICAgICAgICBbc2l6ZV09XCJvcHRpb24uc2l6ZVwiXG4gICAgICAgICAgKGNsaWNrKT1cIm9wdGlvblNlbGVjdGVkKGluZGV4KVwiXG4gICAgICAgICAgW2lkXT1cIm9wdGlvbi5pZCArICdfb3B0aW9uXycgKyAoaW5kZXggKyAxKVwiXG4gICAgICAgID48L2lyY2MtY2wtbGliLWZseW91dC1vcHRpb24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Nkay12aXJ0dWFsLXNjcm9sbC12aWV3cG9ydD5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGVcbiAgI29wdGlvbnNcbiAgbGV0LWNvbmZpZz1cImNvbmZpZ1wiXG4gIGxldC1pbmRleD1cImluZGV4XCJcbj5cbiAgPGlyY2MtY2wtbGliLWZseW91dC1vcHRpb25cbiAgICBbY29uZmlnXT1cImNvbmZpZ1wiXG4gICAgW3ZhbHVlXT1cImNvbmZpZy52YWx1ZSB8IGF1dG9jb21wbGV0ZSA6IHRoaXMuY29uZmlnLnNlbGVjdGVkXCJcbiAgICBbc2l6ZV09XCJjb25maWcuc2l6ZVwiXG4gICAgKGNsaWNrKT1cIm9wdGlvblNlbGVjdGVkKGluZGV4KVwiXG4gICAgW2lkXT1cImNvbmZpZy5pZCArICdfb3B0aW9uXycgKyAoaW5kZXggKyAxKVwiXG4gID48L2lyY2MtY2wtbGliLWZseW91dC1vcHRpb24+XG48L25nLXRlbXBsYXRlPlxuPHNwYW5cbiAgaWQ9XCJzclwiXG4gIGNsYXNzPVwic3Itb25seVwiXG4gIGFyaWEtbGl2ZT1cInBvbGl0ZVwiXG4gID57eyBhMTF5VGV4dCB9fXt7IGN1cnJlbnRTZWxlY3RlZCB9fTwvc3BhblxuPlxuIl19