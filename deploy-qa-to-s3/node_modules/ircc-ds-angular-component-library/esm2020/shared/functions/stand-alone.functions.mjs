import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class StandAloneFunctions {
    constructor(translate) {
        this.translate = translate;
    }
    getErrorAria(formGroup, id, errorMessages) {
        let returnError = '';
        if (formGroup.get(id)?.dirty && formGroup.get(id)?.invalid) {
            errorMessages?.forEach((error) => {
                if (formGroup.get(id)?.errors?.[error.key]) {
                    returnError === ''
                        ? (returnError += this.translate.instant(error.errorLOV))
                        : (returnError += ', ' + this.translate.instant(error.errorLOV));
                }
            });
            returnError += '.';
        }
        return returnError;
    }
    /**
     * When run, returns an IErrorIds object. It generates IDs based on the errorMessages object
     * and which errors are currently in effect, thereby ensuring that the first element is given
     * an id ending in _error0
     * @param formGroup
     * @param id of the parent (input) component
     * @param errorMessages: IErrorPairs[]
     * @returns errorIds: IErrorIDs[]
     */
    getErrorIds(formGroup, id, errorMessages) {
        let errorIds = [];
        errorMessages?.forEach((message) => {
            errorIds.push({ key: message.key, errorLOV: message.errorLOV });
        });
        //Code block to get errors that have occurred before the statusChange obs is activated
        let i = 0;
        errorIds.forEach((error) => {
            if (formGroup.get(id)?.errors?.[error.key]) {
                error.id = id + '_error' + i;
                i++;
            }
        });
        formGroup.get(id)?.statusChanges.subscribe((change) => {
            let i = 0;
            errorIds.forEach((error) => {
                if (formGroup.get(id)?.errors?.[error.key]) {
                    error.id = id + '_error' + i;
                    i++;
                }
            });
        });
        return errorIds;
    }
    /**
     * Given a form group & form control id, set errors & mark as touch on specific form controls
     * @param formGroup
     * @param formID ID of form control
     * @param errorKeys
     */
    setFormErrors(formGroup, formID, errorKeys) {
        const errorVals = {};
        if (errorKeys.length === 0) {
            formGroup.get(formID)?.setErrors(null);
        }
        else {
            errorKeys.forEach((error) => {
                errorVals[error] = true;
            });
            formGroup.get(formID)?.setErrors(errorVals);
            formGroup.get(formID)?.markAsTouched();
        }
    }
    /**
     * Create a label config - for use inside form input components
     * @param formGroup
     * @param id
     * @param parentID
     * @param errorMessages
     * @param label
     * @param desc
     * @param hint
     * @param required
     */
    makeLabelConfig(formGroup, parentID, errorMessages, label, desc, hint, required, iconButton, topLabel) {
        const config = {
            formGroup: formGroup,
            parentID: parentID,
            errorMessages: errorMessages,
            label: label,
            desc: desc,
            hint: hint,
            required: required,
            iconButton: iconButton,
            topLabel: topLabel
        };
        return config;
    }
    /**
     * A function designed to deal with how AWFUL Safari is. Safari does not consider touched to be a valid state in <body>,
     * therefore this is needed to force it to acknowledge the state.
     * @param formGroup
     * @param id of the parent (input) component
     */
    wasTouched(formGroup, id) {
        formGroup.get(id)?.markAsTouched();
    }
    /**
     * Get the current base url.
     * @param baseUrl
     * @param baseUrlKey Translation key of base url
     */
    getBaseUrl(baseUrl = '', baseUrlKey) {
        const curLang = this.translate.currentLang;
        const langKey = curLang === 'en-US' || curLang === 'en' ? 'en' : 'fr';
        let i = window.location.href.slice(window.location.href.indexOf(langKey), window.location.href.length);
        i = i.split('/');
        let index = 0;
        for (const j of i) {
            if (j === this.translate.instant(baseUrlKey ?? '')) {
                baseUrl += '/' + j;
                // Should halt when find the base url segment
                break;
            }
            else if (index !== i.length - 1) {
                baseUrl += '/' + j;
                index += 1;
            }
        }
        if (baseUrl[baseUrl.length] !== '/')
            baseUrl += '/';
        return baseUrl;
    }
}
StandAloneFunctions.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StandAloneFunctions, deps: [{ token: i1.TranslateService }], target: i0.ɵɵFactoryTarget.Injectable });
StandAloneFunctions.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StandAloneFunctions, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StandAloneFunctions, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhbmQtYWxvbmUuZnVuY3Rpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vY29tcG9uZW50LWxpYi9zcmMvc2hhcmVkL2Z1bmN0aW9ucy9zdGFuZC1hbG9uZS5mdW5jdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBa0IzQyxNQUFNLE9BQU8sbUJBQW1CO0lBQzlCLFlBQW9CLFNBQTJCO1FBQTNCLGNBQVMsR0FBVCxTQUFTLENBQWtCO0lBQUcsQ0FBQztJQUVuRCxZQUFZLENBQUMsU0FBb0IsRUFBRSxFQUFVLEVBQUUsYUFBNEI7UUFDekUsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUU7WUFDMUQsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO2dCQUMvQixJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUMxQyxXQUFXLEtBQUssRUFBRTt3QkFDaEIsQ0FBQyxDQUFDLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQzt3QkFDekQsQ0FBQyxDQUFDLENBQUMsV0FBVyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDcEU7WUFDSCxDQUFDLENBQUMsQ0FBQztZQUNILFdBQVcsSUFBSSxHQUFHLENBQUM7U0FDcEI7UUFDRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixD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QUFHLENBQUM7UUFFcEQsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQzs7aUhBbkpVLG1CQUFtQjtxSEFBbkIsbUJBQW1CLGNBRmxCLE1BQU07NEZBRVAsbUJBQW1CO2tCQUgvQixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7XG4gIElMYWJlbENvbmZpZyxcbiAgSUxhYmVsSWNvbkNvbmZpZ1xufSBmcm9tICcuLi8uLi9saWIvc2hhcmVkL2xhYmVsL2xhYmVsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJRXJyb3JQYWlycyB9IGZyb20gJy4uL2ludGVyZmFjZXMvY29tcG9uZW50LWNvbmZpZ3MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElFcnJvcklEcyB7XG4gIGlkPzogc3RyaW5nO1xuICBrZXk6IHN0cmluZztcbiAgZXJyb3JMT1Y6IHN0cmluZztcbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgU3RhbmRBbG9uZUZ1bmN0aW9ucyB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7fVxuXG4gIGdldEVycm9yQXJpYShmb3JtR3JvdXA6IEZvcm1Hcm91cCwgaWQ6IHN0cmluZywgZXJyb3JNZXNzYWdlczogSUVycm9yUGFpcnNbXSkge1xuICAgIGxldCByZXR1cm5FcnJvciA9ICcnO1xuICAgIGlmIChmb3JtR3JvdXAuZ2V0KGlkKT8uZGlydHkgJiYgZm9ybUdyb3VwLmdldChpZCk/LmludmFsaWQpIHtcbiAgICAgIGVycm9yTWVzc2FnZXM/LmZvckVhY2goKGVycm9yKSA9PiB7XG4gICAgICAgIGlmIChmb3JtR3JvdXAuZ2V0KGlkKT8uZXJyb3JzPy5bZXJyb3Iua2V5XSkge1xuICAgICAgICAgIHJldHVybkVycm9yID09PSAnJ1xuICAgICAgICAgICAgPyAocmV0dXJuRXJyb3IgKz0gdGhpcy50cmFuc2xhdGUuaW5zdGFudChlcnJvci5lcnJvckxPVikpXG4gICAgICAgICAgICA6IChyZXR1cm5FcnJvciArPSAnLCAnICsgdGhpcy50cmFuc2xhdGUuaW5zdGFudChlcnJvci5lcnJvckxPVikpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybkVycm9yICs9ICcuJztcbiAgICB9XG4gICAgcmV0dXJuIHJldHVybkVycm9yO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gcnVuLCByZXR1cm5zIGFuIElFcnJvcklkcyBvYmplY3QuIEl0IGdlbmVyYXRlcyBJRHMgYmFzZWQgb24gdGhlIGVycm9yTWVzc2FnZXMgb2JqZWN0XG4gICAqIGFuZCB3aGljaCBlcnJvcnMgYXJlIGN1cnJlbnRseSBpbiBlZmZlY3QsIHRoZXJlYnkgZW5zdXJpbmcgdGhhdCB0aGUgZmlyc3QgZWxlbWVudCBpcyBnaXZlblxuICAgKiBhbiBpZCBlbmRpbmcgaW4gX2Vycm9yMFxuICAgKiBAcGFyYW0gZm9ybUdyb3VwXG4gICAqIEBwYXJhbSBpZCBvZiB0aGUgcGFyZW50IChpbnB1dCkgY29tcG9uZW50XG4gICAqIEBwYXJhbSBlcnJvck1lc3NhZ2VzOiBJRXJyb3JQYWlyc1tdXG4gICAqIEByZXR1cm5zIGVycm9ySWRzOiBJRXJyb3JJRHNbXVxuICAgKi9cbiAgZ2V0RXJyb3JJZHMoZm9ybUdyb3VwOiBGb3JtR3JvdXAsIGlkOiBzdHJpbmcsIGVycm9yTWVzc2FnZXM6IElFcnJvclBhaXJzW10pIHtcbiAgICBsZXQgZXJyb3JJZHM6IElFcnJvcklEc1tdID0gW107XG4gICAgZXJyb3JNZXNzYWdlcz8uZm9yRWFjaCgobWVzc2FnZSkgPT4ge1xuICAgICAgZXJyb3JJZHMucHVzaCh7IGtleTogbWVzc2FnZS5rZXksIGVycm9yTE9WOiBtZXNzYWdlLmVycm9yTE9WIH0pO1xuICAgIH0pO1xuXG4gICAgLy9Db2RlIGJsb2NrIHRvIGdldCBlcnJvcnMgdGhhdCBoYXZlIG9jY3VycmVkIGJlZm9yZSB0aGUgc3RhdHVzQ2hhbmdlIG9icyBpcyBhY3RpdmF0ZWRcbiAgICBsZXQgaSA9IDA7XG4gICAgZXJyb3JJZHMuZm9yRWFjaCgoZXJyb3IpID0+IHtcbiAgICAgIGlmIChmb3JtR3JvdXAuZ2V0KGlkKT8uZXJyb3JzPy5bZXJyb3Iua2V5XSkge1xuICAgICAgICBlcnJvci5pZCA9IGlkICsgJ19lcnJvcicgKyBpO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBmb3JtR3JvdXAuZ2V0KGlkKT8uc3RhdHVzQ2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZSkgPT4ge1xuICAgICAgbGV0IGkgPSAwO1xuICAgICAgZXJyb3JJZHMuZm9yRWFjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgaWYgKGZvcm1Hcm91cC5nZXQoaWQpPy5lcnJvcnM/LltlcnJvci5rZXldKSB7XG4gICAgICAgICAgZXJyb3IuaWQgPSBpZCArICdfZXJyb3InICsgaTtcbiAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBlcnJvcklkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBHaXZlbiBhIGZvcm0gZ3JvdXAgJiBmb3JtIGNvbnRyb2wgaWQsIHNldCBlcnJvcnMgJiBtYXJrIGFzIHRvdWNoIG9uIHNwZWNpZmljIGZvcm0gY29udHJvbHNcbiAgICogQHBhcmFtIGZvcm1Hcm91cFxuICAgKiBAcGFyYW0gZm9ybUlEIElEIG9mIGZvcm0gY29udHJvbFxuICAgKiBAcGFyYW0gZXJyb3JLZXlzXG4gICAqL1xuICBzZXRGb3JtRXJyb3JzKGZvcm1Hcm91cDogRm9ybUdyb3VwLCBmb3JtSUQ6IHN0cmluZywgZXJyb3JLZXlzOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IGVycm9yVmFscyA9IHt9O1xuICAgIGlmIChlcnJvcktleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBmb3JtR3JvdXAuZ2V0KGZvcm1JRCk/LnNldEVycm9ycyhudWxsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXJyb3JLZXlzLmZvckVhY2goKGVycm9yKSA9PiB7XG4gICAgICAgIGVycm9yVmFsc1tlcnJvcl0gPSB0cnVlO1xuICAgICAgfSk7XG4gICAgICBmb3JtR3JvdXAuZ2V0KGZvcm1JRCk/LnNldEVycm9ycyhlcnJvclZhbHMpO1xuICAgICAgZm9ybUdyb3VwLmdldChmb3JtSUQpPy5tYXJrQXNUb3VjaGVkKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGxhYmVsIGNvbmZpZyAtIGZvciB1c2UgaW5zaWRlIGZvcm0gaW5wdXQgY29tcG9uZW50c1xuICAgKiBAcGFyYW0gZm9ybUdyb3VwXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gcGFyZW50SURcbiAgICogQHBhcmFtIGVycm9yTWVzc2FnZXNcbiAgICogQHBhcmFtIGxhYmVsXG4gICAqIEBwYXJhbSBkZXNjXG4gICAqIEBwYXJhbSBoaW50XG4gICAqIEBwYXJhbSByZXF1aXJlZFxuICAgKi9cbiAgbWFrZUxhYmVsQ29uZmlnKFxuICAgIGZvcm1Hcm91cDogRm9ybUdyb3VwLFxuICAgIHBhcmVudElEOiBzdHJpbmcsXG4gICAgZXJyb3JNZXNzYWdlcz86IElFcnJvclBhaXJzW10sXG4gICAgbGFiZWw/OiBzdHJpbmcsXG4gICAgZGVzYz86IHN0cmluZyxcbiAgICBoaW50Pzogc3RyaW5nLFxuICAgIHJlcXVpcmVkPzogYm9vbGVhbixcbiAgICBpY29uQnV0dG9uPzogSUxhYmVsSWNvbkNvbmZpZyxcbiAgICB0b3BMYWJlbD86IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBjb25maWc6IElMYWJlbENvbmZpZyA9IHtcbiAgICAgIGZvcm1Hcm91cDogZm9ybUdyb3VwLFxuICAgICAgcGFyZW50SUQ6IHBhcmVudElELFxuICAgICAgZXJyb3JNZXNzYWdlczogZXJyb3JNZXNzYWdlcyxcbiAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgIGRlc2M6IGRlc2MsXG4gICAgICBoaW50OiBoaW50LFxuICAgICAgcmVxdWlyZWQ6IHJlcXVpcmVkLFxuICAgICAgaWNvbkJ1dHRvbjogaWNvbkJ1dHRvbixcbiAgICAgIHRvcExhYmVsOiB0b3BMYWJlbFxuICAgIH07XG4gICAgcmV0dXJuIGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIGZ1bmN0aW9uIGRlc2lnbmVkIHRvIGRlYWwgd2l0aCBob3cgQVdGVUwgU2FmYXJpIGlzLiBTYWZhcmkgZG9lcyBub3QgY29uc2lkZXIgdG91Y2hlZCB0byBiZSBhIHZhbGlkIHN0YXRlIGluIDxib2R5PixcbiAgICogdGhlcmVmb3JlIHRoaXMgaXMgbmVlZGVkIHRvIGZvcmNlIGl0IHRvIGFja25vd2xlZGdlIHRoZSBzdGF0ZS5cbiAgICogQHBhcmFtIGZvcm1Hcm91cFxuICAgKiBAcGFyYW0gaWQgb2YgdGhlIHBhcmVudCAoaW5wdXQpIGNvbXBvbmVudFxuICAgKi9cbiAgd2FzVG91Y2hlZChmb3JtR3JvdXA6IEZvcm1Hcm91cCwgaWQ6IHN0cmluZykge1xuICAgIGZvcm1Hcm91cC5nZXQoaWQpPy5tYXJrQXNUb3VjaGVkKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IGJhc2UgdXJsLlxuICAgKiBAcGFyYW0gYmFzZVVybFxuICAgKiBAcGFyYW0gYmFzZVVybEtleSBUcmFuc2xhdGlvbiBrZXkgb2YgYmFzZSB1cmxcbiAgICovXG4gIGdldEJhc2VVcmwoYmFzZVVybDogc3RyaW5nID0gJycsIGJhc2VVcmxLZXk/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGN1ckxhbmcgPSB0aGlzLnRyYW5zbGF0ZS5jdXJyZW50TGFuZztcbiAgICBjb25zdCBsYW5nS2V5ID0gY3VyTGFuZyA9PT0gJ2VuLVVTJyB8fCBjdXJMYW5nID09PSAnZW4nID8gJ2VuJyA6ICdmcic7XG4gICAgbGV0IGk6IHN0cmluZyB8IHN0cmluZ1tdID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc2xpY2UoXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKGxhbmdLZXkpLFxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYubGVuZ3RoXG4gICAgKTtcbiAgICBpID0gaS5zcGxpdCgnLycpO1xuXG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBmb3IgKGNvbnN0IGogb2YgaSkge1xuICAgICAgaWYgKGogPT09IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoYmFzZVVybEtleSA/PyAnJykpIHtcbiAgICAgICAgYmFzZVVybCArPSAnLycgKyBqO1xuICAgICAgICAvLyBTaG91bGQgaGFsdCB3aGVuIGZpbmQgdGhlIGJhc2UgdXJsIHNlZ21lbnRcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2UgaWYgKGluZGV4ICE9PSBpLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgYmFzZVVybCArPSAnLycgKyBqO1xuICAgICAgICBpbmRleCArPSAxO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYmFzZVVybFtiYXNlVXJsLmxlbmd0aF0gIT09ICcvJykgYmFzZVVybCArPSAnLyc7XG5cbiAgICByZXR1cm4gYmFzZVVybDtcbiAgfVxufVxuIl19